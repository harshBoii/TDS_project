{"version":3,"sources":["../src/errors/errors.ts","../src/plugins/http-client/http-client.error.ts","../src/plugins/telemetry/telemetry.manager.ts","../src/plugins/http-client/isomorphic.http-client.ts","../src/plugins/queue/queue.error.ts","../src/plugins/queue/queue.interface.ts","../src/utils/utils.ts","../src/plugins/logger/logger.manager.ts","../src/plugins/logger/console.logger.ts","../src/plugins/queue/simple.queue.ts","../src/plugins/cache/lru.cache.ts","../src/plugins/analytics/no-op.analytics.ts","../src/plugins/analytics/analytics.utils.ts","../src/plugins/analytics/post.analytics.ts","../src/plugins/analytics/analytics.manager.ts","../src/gateway.types.ts","../src/handlers/complete-chat/complete-chat.handler.ts","../src/handlers/complete-chat/complete-chat.types.ts","../src/handlers/get-chat-usage-cost/get-chat-usage-cost.handler.ts","../src/handlers/get-embeddings/get-embeddings.types.ts","../src/handlers/get-embeddings/get-embeddings.handler.ts","../src/handlers/proxy-complete-chat/proxy-complete-chat.types.ts","../src/handlers/proxy-complete-chat/proxy-complete-chat.handler.ts","../src/handlers/proxy-get-embeddings/proxy-get-embeddings.handler.ts","../src/handlers/proxy-get-embeddings/proxy-get-embeddings.types.ts","../src/handlers/proxy-stream-chat/proxy-stream-chat.handler.ts","../src/handlers/proxy-stream-chat/proxy-stream-chat.types.ts","../src/handlers/stream-chat/stream-chat.handler.ts","../src/handlers/stream-chat/stream-chat.types.ts","../src/gateway.ts","../src/handlers/get-chat-usage-cost/get-chat-usage-cost.types.ts"],"names":["GatewayError","_GatewayError","message","status","data","GatewayTelemetryErrorLiteral","GatewayTelemetryError","_GatewayTelemetryError","GatewayBaseError","info","cause","error","HttpClientErrorLiteral","HttpClientError","_HttpClientError","HttpRequestErrorLiteral","HttpRequestError","_HttpRequestError","headers","TelemetryManager","tracer","trace","meter","metrics","convertHeadersToRecord","headerRecord","key","value","axiosToHttpRequestError","_a","_b","_c","IsomorphicHttpClient","config","axiosInstance","timeoutInMilliseconds","enableProxyAgent","axios","Timeout","z","ProxyAgent","logger","LoggerManager","_0","_1","_2","__async","method","url","dataOrParams","additionalConfig","telemetryContext","_makeRequest","span","__spreadValues","__spreadProps","resp","SpanStatusCode","response","context","ATTR_HTTP_REQUEST_METHOD","ATTR_URL_FULL","options","__asyncGenerator","_stream","requestStart","timeToFirstTokenSet","__await","iter","__forAwait","more","temp","chunk","ttfb","decodedChunk","fetchConfig","text","reader","done","decodedValue","__yieldStar","params","QueueTaskTimeoutErrorLiteral","QueueTaskTimeoutError","_QueueTaskTimeoutError","QueueOptions","getCacheKeyHash","prefix","object","sha256","castToError","err","isRunningInBrowser","logColors","verbose","level","action","args","debug","safelyInvokeCallbacks","callbacks","name","promises","callback","func","result","delay","ms","resolve","ConsoleLogger","SimpleQueue","task","taskSpan","taskTelemetryContext","reject","timeout","retryRemaining","shouldRetry","delayMs","taskRequest","GatewayCompleteChatRequest","retryDelay","retrySpan","item","LRUCache","maxEntries","LRU","NoOpAnalytics","event","dimensions","getNodeDetails","os","getBrowserDetails","PostAnalytics","analyticsEvent","eventsToSend","events","e","AnalyticsManager","enableAnalytics","GatewayOptions","GatewayCompleteChatRequestOptions","Config","Message","Tool","GatewayStreamChatRequestOptions","GatewayStreamChatRequest","GatewayGetEmbeddingsRequestOptions","GatewayGetEmbeddingsRequest","EmbeddingRequests","GatewayProxyCompleteChatRequest","GatewayProxyStreamChatRequest","GatewayProxyGetEmbeddingsRequest","GatewayGetChatUsageCostRequest","CompleteChatHandlerRequest","CompleteChatHandlerResponse","ChatResponse","handleCompleteChat","request","client","_handleCompleteChat","handlerTelemetryContext","providerData","providerRequest","cacheKey","cachedResponse","now","providerResponse","latencyInMs","safeError","handleGetChatUsageCost","promptTokens","completionTokens","tokenRanges","getRate","tokens","kind","tokenRange","t","rate","inputRatePerMillion","outputRatePerMillion","inputCost","outputCost","GetEmbeddingsHandlerRequest","GetEmbeddingsHandlerResponse","EmbeddingResponse","handleGetEmbeddings","_handleGetEmbeddings","ProxyCompleteChatHandlerRequest","ProxyCompleteChatHandlerResponse","handleProxyCompleteChat","_handleProxyCompleteChat","transformedResponse","transformationError","ProxyGetEmbeddingsHandlerRequest","ProxyGetEmbeddingsHandlerResponse","handleProxyGetEmbeddings","_handleProxyGetEmbeddings","sanitizedProviderRequest","ProxyStreamChatHandlerRequest","ProxyStreamChatHandlerResponse","PartialChatResponse","handleProxyStreamChat","_handleProxyStreamChat","buffer","accumulatedPartialResponse","transformed","hasMessages","hasUsage","streamResponse","StreamChatHandlerRequest","StreamChatHandlerResponse","handleStreamChat","_handleStreamChat","stable","isFirstResponse","Gateway","_d","_e","_f","_g","queueOptions","modelName","uuidv4","activeContext","GetChatUsageCostHandlerRequest","GetChatUsageCostHandlerResponse"],"mappings":"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","file":"index.js","sourcesContent":["import { GatewayBaseError } from \"@adaline/types\";\n\nclass GatewayError extends Error {\n  status: number;\n  data: unknown;\n\n  constructor(message: string, status: number = 500, data?: unknown) {\n    super(message);\n    this.name = \"GatewayError\";\n    this.status = status;\n    this.data = data;\n\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, GatewayError);\n    }\n  }\n}\n\nconst GatewayTelemetryErrorLiteral = \"GatewayTelemetryError\" as const;\nclass GatewayTelemetryError extends GatewayBaseError {\n  readonly info: string;\n  readonly cause: unknown;\n\n  constructor({ info, cause }: { info: string; cause: unknown }) {\n    super({ info, cause }, GatewayTelemetryErrorLiteral);\n    this.info = info;\n    this.cause = cause;\n    Object.setPrototypeOf(this, new.target.prototype);\n  }\n\n  static isGatewayTelemetryError(error: unknown): error is GatewayTelemetryError {\n    return error instanceof GatewayTelemetryError;\n  }\n}\n\nexport { GatewayError, GatewayTelemetryError };\n","import { GatewayBaseError } from \"@adaline/types\";\n\nconst HttpClientErrorLiteral = \"HttpClientError\" as const;\nclass HttpClientError extends GatewayBaseError {\n  readonly info: string;\n  readonly cause: unknown;\n\n  constructor({ info, cause }: { info: string; cause: unknown }) {\n    super({ info, cause }, HttpClientErrorLiteral);\n    this.info = info;\n    this.cause = cause;\n    Object.setPrototypeOf(this, new.target.prototype);\n  }\n\n  static isHttpClientError(error: unknown): error is HttpClientError {\n    return error instanceof HttpClientError;\n  }\n}\n\nconst HttpRequestErrorLiteral = \"HttpRequestError\" as const;\nclass HttpRequestError extends GatewayBaseError {\n  readonly info: string;\n  readonly cause: {\n    status: number;\n    headers: Record<string, string>;\n    data: unknown;\n  };\n\n  constructor(message: string, status: number = 500, headers: Record<string, string>, data: unknown) {\n    super({ info: message, cause: { status, headers, data } }, HttpRequestErrorLiteral);\n    this.info = message;\n    this.cause = { status, headers, data };\n    Object.setPrototypeOf(this, new.target.prototype);\n  }\n\n  static isHttpRequestError(error: unknown): error is HttpRequestError {\n    return error instanceof HttpRequestError;\n  }\n}\n\nexport { HttpClientError, HttpRequestError };\n","import { Meter, metrics, trace, Tracer } from \"@opentelemetry/api\";\n\nclass TelemetryManager {\n  static DEFAULT_TRACER_KEY = \"gateway\";\n  static DEFAULT_METER_KEY = \"gateway\";\n\n  private static tracer: Tracer | undefined = undefined;\n  private static meter: Meter | undefined = undefined;\n\n  static setTracer(tracer: Tracer | undefined): void {\n    if (!this.tracer) {\n      this.tracer = tracer || trace.getTracer(this.DEFAULT_TRACER_KEY);\n    }\n  }\n\n  static getTracer(): Tracer {\n    return this.tracer || trace.getTracer(this.DEFAULT_TRACER_KEY);\n  }\n\n  static setMeter(meter: Meter | undefined): void {\n    if (!this.meter) {\n      this.meter = meter || metrics.getMeter(this.DEFAULT_METER_KEY);\n    }\n  }\n\n  static getMeter(): Meter {\n    return this.meter || metrics.getMeter(this.DEFAULT_METER_KEY);\n  }\n}\n\nexport { TelemetryManager };\n","import { Context, context, Span, SpanStatusCode, Tracer } from \"@opentelemetry/api\";\nimport { ATTR_HTTP_REQUEST_METHOD, ATTR_URL_FULL } from \"@opentelemetry/semantic-conventions\";\nimport axios, { AxiosError, AxiosInstance, AxiosRequestConfig } from \"axios\";\nimport type { ProxyAgent } from \"proxy-agent\";\nimport { z } from \"zod\";\n\nimport { LoggerManager } from \"../../plugins\";\nimport { TelemetryManager } from \"../../plugins/telemetry\";\nimport { HttpClientError, HttpRequestError } from \"./http-client.error\";\nimport { HttpClient, HttpClientResponse } from \"./http-client.interface\";\n\nconst convertHeadersToRecord = (headers: any): Record<string, string> => {\n  const headerRecord: Record<string, string> = {};\n  if (headers && (typeof headers === \"object\" || headers instanceof Headers)) {\n    Object.entries(headers).forEach(([key, value]) => {\n      if (Array.isArray(value)) {\n        headerRecord[key] = value.join(\", \");\n      } else if (typeof value === \"string\") {\n        headerRecord[key] = value;\n      } else {\n        headerRecord[key] = \"\";\n      }\n    });\n  }\n\n  return headerRecord;\n};\n\nconst axiosToHttpRequestError = (error: AxiosError): HttpRequestError => {\n  const message = error?.message || \"An unexpected error occurred\";\n  const status = error?.response?.status || 500;\n  const headers = convertHeadersToRecord(error?.response?.headers) || {};\n  const data = error?.response?.data || {};\n  return new HttpRequestError(message, status, headers, data);\n};\n\ninterface IsomorphicHttpClientConfig {\n  timeoutInMilliseconds?: number;\n  axiosInstance?: AxiosInstance;\n  telemetryTracer?: Tracer;\n  enableProxyAgent?: boolean;\n}\n\nclass IsomorphicHttpClient implements HttpClient {\n  private defaultTimeout?: number;\n  private client: AxiosInstance;\n  private httpProxyAgent?: ProxyAgent;\n  private httpsProxyAgent?: ProxyAgent;\n  private enableProxyAgent: boolean;\n\n  constructor(config: IsomorphicHttpClientConfig) {\n    const { axiosInstance, timeoutInMilliseconds, enableProxyAgent } = config;\n    this.client = axiosInstance || axios.create();\n\n    const Timeout = z.number().int().positive().optional();\n    this.defaultTimeout = Timeout.parse(timeoutInMilliseconds);\n\n    this.client.defaults.timeout = this.defaultTimeout;\n\n    // Enable proxy agent by default unless explicitly disabled\n    this.enableProxyAgent = enableProxyAgent ?? true;\n\n    if (this.enableProxyAgent) {\n      // Use require here to avoid importing in a browser build\n      const ProxyAgent = require(\"proxy-agent\");\n      this.httpProxyAgent = new ProxyAgent.ProxyAgent();\n      this.httpsProxyAgent = new ProxyAgent.ProxyAgent({\n        rejectUnauthorized: false, // Don't check SSL cert\n      });\n    }\n    const logger = LoggerManager.getLogger();\n    logger?.debug(`IsomorphicHttpClient initialized with defaultTimeout: ${this.defaultTimeout}`);\n  }\n\n  isNodeEnvironment = (): boolean => {\n    return typeof process !== \"undefined\" && process.versions != null && process.versions.node != null;\n  };\n\n  private async makeRequest<T>(\n    method: \"get\" | \"post\" | \"put\" | \"delete\" | \"patch\",\n    url: string,\n    dataOrParams: Record<string, unknown>,\n    additionalConfig: AxiosRequestConfig = {},\n    telemetryContext?: Context\n  ): Promise<HttpClientResponse<T>> {\n    const logger = LoggerManager.getLogger();\n    const _makeRequest = async <T>(span?: Span): Promise<HttpClientResponse<T>> => {\n      try {\n        const config: AxiosRequestConfig = {\n          ...(method === \"get\" || method === \"delete\" ? { params: dataOrParams } : { data: dataOrParams }),\n          ...additionalConfig,\n          timeout: this.defaultTimeout,\n          ...(this.enableProxyAgent\n            ? {\n                httpAgent: this.httpProxyAgent,\n                httpsAgent: this.httpsProxyAgent,\n              }\n            : {}),\n        };\n\n        if (method === \"get\" || method === \"delete\") {\n          const resp = await this.client[method]<T>(url, config);\n          span?.setStatus({ code: SpanStatusCode.OK, message: \"request successful\" });\n          const response = {\n            data: resp.data,\n            headers: convertHeadersToRecord(resp.headers),\n            status: {\n              code: resp.status,\n              text: resp.statusText,\n            },\n          };\n          logger?.debug(\"IsomorphicHttpClient.makeRequest response: \", response);\n          return response;\n        } else {\n          const resp = await this.client[method]<T>(url, config.data, {\n            ...config,\n            params: config.params,\n          });\n          span?.setStatus({ code: SpanStatusCode.OK, message: \"request successful\" });\n          const response = {\n            data: resp.data,\n            headers: convertHeadersToRecord(resp.headers),\n            status: {\n              code: resp.status,\n              text: resp.statusText,\n            },\n          };\n          logger?.debug(\"IsomorphicHttpClient.makeRequest response: \", response);\n          return response;\n        }\n      } catch (error) {\n        logger?.warn(\"IsomorphicHttpClient.makeRequest error: \", error);\n        span?.setStatus({ code: SpanStatusCode.ERROR, message: \"request failed\" });\n        if (axios.isAxiosError(error)) throw axiosToHttpRequestError(error);\n        throw new HttpClientError({ info: \"An unexpected error occurred\", cause: error });\n      } finally {\n        span?.end();\n      }\n    };\n\n    if (!telemetryContext) {\n      return _makeRequest<T>();\n    }\n\n    return await context.with(telemetryContext, async () => {\n      const tracer = TelemetryManager.getTracer();\n      return await tracer.startActiveSpan(\"http.request\", async (span: Span) => {\n        span.setAttribute(ATTR_HTTP_REQUEST_METHOD, method.toUpperCase());\n        span.setAttribute(ATTR_URL_FULL, url);\n        return await _makeRequest<T>(span);\n      });\n    });\n  }\n\n  // TODO: needs testing for with context and without context\n  async *stream<T>(\n    url: string,\n    method: \"get\" | \"post\",\n    data?: Record<string, unknown>,\n    headers?: Record<string, string>,\n    options?: {\n      abortSignal?: AbortSignal;\n    },\n    telemetryContext?: Context\n  ): AsyncGenerator<T, void, unknown> {\n    const logger = LoggerManager.getLogger();\n    logger?.debug(`IsomorphicHttpClient.STREAM request to ${url}`, { data, headers });\n    const _stream = async function* (this: IsomorphicHttpClient, span?: Span): AsyncGenerator<T, void, unknown> {\n      // Record the time we start the request for TTFT measurement\n      const requestStart = Date.now();\n      let timeToFirstTokenSet = false;\n\n      try {\n        if (this.isNodeEnvironment()) {\n          logger?.debug(\"IsomorphicHttpClient.stream in node environment\");\n          const response = await this.client.request({\n            method,\n            url,\n            headers,\n            data,\n            responseType: \"stream\",\n            signal: options?.abortSignal,\n          });\n\n          for await (const chunk of response.data) {\n            // Set time-to-first-token if this is the first chunk\n            if (!timeToFirstTokenSet) {\n              const ttfb = Date.now() - requestStart;\n              span?.setAttribute(\"time-to-first-token\", ttfb);\n              timeToFirstTokenSet = true;\n            }\n            span?.addEvent(\"stream.chunk\", { message: \"stream chunk received\" });\n            const decodedChunk = chunk.toString();\n            logger?.debug(\"IsomorphicHttpClient.stream chunk: \", decodedChunk);\n            yield decodedChunk as unknown as T;\n          }\n          span?.setStatus({ code: SpanStatusCode.OK, message: \"stream successful\" });\n        } else {\n          logger?.debug(\"IsomorphicHttpClient.stream in browser environment\");\n          const fetchConfig: RequestInit = {\n            method,\n            headers: new Headers({\n              ...headers,\n            }),\n            body: method !== \"get\" ? JSON.stringify(data) : undefined,\n            signal: options?.abortSignal,\n          };\n          const response = await fetch(url, fetchConfig);\n\n          if (!response.ok) {\n            logger?.warn(\"IsomorphicHttpClient.stream response not ok: \", response);\n            span?.setStatus({ code: SpanStatusCode.ERROR, message: \"stream failed\" });\n            const text: any = await response.json();\n            throw new HttpRequestError(\n              `Request failed with status ${response.status}`,\n              response.status,\n              convertHeadersToRecord(response.headers),\n              text\n            );\n          }\n\n          if (response.body) {\n            const reader = response.body.getReader();\n            while (true) {\n              const { done, value } = await reader.read();\n              if (done) {\n                // Set time-to-first-token if we receive data on the last chunk\n                if (!timeToFirstTokenSet && value) {\n                  const ttfb = Date.now() - requestStart;\n                  span?.setAttribute(\"time-to-first-token\", ttfb);\n                  timeToFirstTokenSet = true;\n                }\n                span?.addEvent(\"stream.chunk\", { message: \"stream chunk received\" });\n                const decodedValue = new TextDecoder().decode(value, { stream: true });\n                logger?.debug(\"IsomorphicHttpClient.stream chunk: \", decodedValue);\n                yield decodedValue as unknown as T;\n                break;\n              }\n\n              // Set time-to-first-token if this is the first chunk\n              if (!timeToFirstTokenSet) {\n                const ttfb = Date.now() - requestStart;\n                span?.setAttribute(\"time-to-first-token\", ttfb);\n                timeToFirstTokenSet = true;\n              }\n              span?.addEvent(\"stream.chunk\", { message: \"stream chunk received\" });\n              const decodedValue = new TextDecoder().decode(value, { stream: true });\n              logger?.debug(\"IsomorphicHttpClient.stream chunk: \", decodedValue);\n              yield decodedValue as unknown as T;\n            }\n            span?.setStatus({ code: SpanStatusCode.OK, message: \"stream successful\" });\n          } else {\n            logger?.warn(\"IsomorphicHttpClient.stream response has no body\");\n            span?.setStatus({ code: SpanStatusCode.ERROR, message: \"stream failed\" });\n            throw new HttpRequestError(\"Cannot stream the body of the response.\", 500, {}, response);\n          }\n        }\n      } catch (error: any) {\n        logger?.warn(\"IsomorphicHttpClient.stream error: \", error);\n        span?.setStatus({ code: SpanStatusCode.ERROR, message: \"stream failed\" });\n        if (HttpRequestError.isHttpRequestError(error)) throw error;\n        if (error?.name === \"AbortError\") throw new HttpRequestError(\"AbortError\", 408, {}, {});\n        if (error?.name === \"CanceledError\") throw new HttpRequestError(\"AbortError\", 408, {}, {});\n        // TODO: how to convert non-axios errors to HttpRequestError for fetch aka browser environment\n        if (axios.isAxiosError(error)) throw axiosToHttpRequestError(error);\n        throw new HttpClientError({ info: \"An unexpected error occurred\", cause: error });\n      } finally {\n        span?.end();\n      }\n    }.bind(this);\n\n    if (!telemetryContext) {\n      return yield* _stream();\n    }\n\n    return yield* await context.with(telemetryContext, async () => {\n      const tracer = TelemetryManager.getTracer();\n      return await tracer.startActiveSpan(\"http.stream\", async (span: Span) => {\n        span.setAttribute(ATTR_HTTP_REQUEST_METHOD, method.toUpperCase());\n        span.setAttribute(ATTR_URL_FULL, url);\n        return await _stream(span);\n      });\n    });\n  }\n\n  async get<T>(\n    url: string,\n    params?: Record<string, unknown>,\n    headers?: Record<string, string | undefined>,\n    telemetryContext?: Context\n  ): Promise<HttpClientResponse<T>> {\n    const logger = LoggerManager.getLogger();\n    logger?.debug(`IsomorphicHttpClient.GET request to ${url}`, { params, headers });\n    return this.makeRequest<T>(\"get\", url, params || {}, { headers }, telemetryContext);\n  }\n\n  async post<T>(\n    url: string,\n    data?: Record<string, unknown>,\n    headers?: Record<string, string | undefined>,\n    telemetryContext?: Context\n  ): Promise<HttpClientResponse<T>> {\n    const logger = LoggerManager.getLogger();\n    logger?.debug(`IsomorphicHttpClient.POST request to ${url}`, { data, headers });\n    return this.makeRequest<T>(\"post\", url, data || {}, { headers }, telemetryContext);\n  }\n\n  async put<T>(\n    url: string,\n    data?: Record<string, unknown>,\n    headers?: Record<string, string | undefined>,\n    telemetryContext?: Context\n  ): Promise<HttpClientResponse<T>> {\n    const logger = LoggerManager.getLogger();\n    logger?.debug(`IsomorphicHttpClient.PUT request to ${url}`, { data, headers });\n    return this.makeRequest<T>(\"put\", url, data || {}, { headers }, telemetryContext);\n  }\n\n  async delete<T>(\n    url: string,\n    params?: Record<string, unknown>,\n    headers?: Record<string, string | undefined>,\n    telemetryContext?: Context\n  ): Promise<HttpClientResponse<T>> {\n    const logger = LoggerManager.getLogger();\n    logger?.debug(`IsomorphicHttpClient.DELETE request to ${url}`, { params, headers });\n    return this.makeRequest<T>(\"delete\", url, params || {}, { headers }, telemetryContext);\n  }\n\n  async patch<T>(\n    url: string,\n    data?: Record<string, unknown>,\n    headers?: Record<string, string | undefined>,\n    telemetryContext?: Context\n  ): Promise<HttpClientResponse<T>> {\n    const logger = LoggerManager.getLogger();\n    logger?.debug(`IsomorphicHttpClient.PATCH request to ${url}`, { data, headers });\n    return this.makeRequest<T>(\"patch\", url, data || {}, { headers }, telemetryContext);\n  }\n}\n\nexport { IsomorphicHttpClient };\n","import { GatewayBaseError } from \"@adaline/types\";\n\nconst QueueTaskTimeoutErrorLiteral = \"QueueTaskTimeoutError\" as const;\nclass QueueTaskTimeoutError extends GatewayBaseError {\n  readonly info: string;\n  readonly cause: unknown;\n\n  constructor({ info, cause }: { info: string; cause: unknown }) {\n    super({ info, cause }, QueueTaskTimeoutErrorLiteral);\n    this.info = info;\n    this.cause = cause;\n    Object.setPrototypeOf(this, new.target.prototype);\n  }\n\n  static isQueueTaskTimeoutError(error: unknown): error is QueueTaskTimeoutError {\n    return error instanceof QueueTaskTimeoutError;\n  }\n}\n\nexport { QueueTaskTimeoutError };\n","import { Context } from \"@opentelemetry/api\";\nimport { z } from \"zod\";\n\nimport { type Cache } from \"../cache\";\n\ntype QueueTask<Request, Response> = {\n  id: string;\n  request: Request;\n  cache?: Cache<Response>;\n  resolve: (value: Response) => void;\n  reject: (error: any) => void;\n  execute: (request: Request, context: Context) => Promise<Response>;\n  telemetryContext: Context;\n};\n\ninterface Queue<Request, Response> {\n  enqueue(task: QueueTask<Request, Response>): void;\n}\n\nconst QueueOptions = z.object({\n  maxConcurrentTasks: z.number().int().positive(),\n  retryCount: z.number().int().positive(),\n  timeout: z.number().int().positive(),\n  retry: z.object({\n    initialDelay: z.number().int().positive(),\n    exponentialFactor: z.number().int().positive(),\n  }),\n});\ntype QueueOptionsType = z.infer<typeof QueueOptions>;\n\nexport { QueueOptions, type Queue, type QueueOptionsType, type QueueTask };\n","import sha256 from \"crypto-js/sha256.js\";\n\nimport { GatewayError } from \"../errors/errors\";\nimport { HttpClientError } from \"../plugins/http-client/http-client.error\";\n\nconst getCacheKeyHash = (prefix: string, object: object): string => {\n  return sha256(prefix + JSON.stringify(object)).toString();\n};\n\nconst castToError = (err: any): GatewayError => {\n  if (err instanceof GatewayError) return err;\n  if (HttpClientError.isHttpClientError(err)) return new GatewayError(err.message as string);\n  if (err instanceof Error) return new GatewayError(err.message as string);\n  return new GatewayError(err);\n};\n\nconst isRunningInBrowser = () => {\n  // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n  // @ts-ignore\n  return typeof window !== \"undefined\" && typeof window.document !== \"undefined\" && typeof navigator !== \"undefined\";\n};\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nconst logLevels = {\n  error: 0,\n  warn: 1,\n  info: 2,\n};\n\nconst logColors = {\n  error: \"color: red\",\n  warn: \"color: yellow\",\n  info: \"color: green\",\n};\n\nconst verbose = (level: keyof typeof logLevels, action: string, ...args: any[]) => {\n  if (!isRunningInBrowser()) {\n    // Node.js environment\n    switch (level) {\n      case \"error\":\n        console.error(...args);\n        break;\n      case \"warn\":\n        console.warn(...args);\n        break;\n      default:\n        console.log(...args);\n    }\n  } else if (isRunningInBrowser()) {\n    // Browser environment\n    console.log(`%c[${level.toUpperCase()}] [${action}]`, logColors[level], ...args);\n  }\n};\n\nconst debug = (level: keyof typeof logLevels, action: string, ...args: any[]) => {\n  if (isRunningInBrowser()) return;\n  // eslint-disable-next-line turbo/no-undeclared-env-vars\n  if (process?.env?.DEBUG !== \"true\") return;\n  verbose(level, action, ...args);\n};\n\ntype Prettify<T> = {\n  [K in keyof T]: T[K];\n} & unknown;\n\ninterface BaseCallback {\n  [key: string]: (...args: any[]) => void | Promise<void>;\n}\n\ntype ArgumentsType<T> = T extends (...args: infer A) => any ? A : never;\n\nconst safelyInvokeCallbacks = async <T extends BaseCallback, K extends keyof T>(\n  callbacks: T[],\n  name: keyof T,\n  ...args: ArgumentsType<T[K]>\n): Promise<void> => {\n  const promises: Promise<void>[] = [];\n\n  callbacks.forEach((callback) => {\n    const func = callback[name];\n    if (typeof func === \"function\") {\n      try {\n        const result = func(...args);\n        if (result instanceof Promise) {\n          promises.push(result);\n        }\n      } catch (error) {\n        debug(\"error\", `SAFELY_INVOKE_CALLBACKS:${String(name)}:`, error);\n      }\n    }\n  });\n\n  await Promise.allSettled(promises);\n};\n\nconst delay = (ms: number) => new Promise((resolve) => setTimeout(resolve, ms));\n\nconst calcRateLimitRetryTimeout = (\n  maxRetries: number,\n  backOffInitialDelay: number,\n  backOffMultiplier: number,\n  executionTimePerAttempt: number\n): number => {\n  let totalDelayTime = 0;\n  const totalExecutionTime = maxRetries * executionTimePerAttempt;\n\n  for (let i = 0; i < maxRetries; i++) {\n    totalDelayTime += backOffInitialDelay * Math.pow(backOffMultiplier, i);\n  }\n\n  return totalDelayTime + totalExecutionTime;\n};\n\nconst defaultShouldRetry = (status: number) => {\n  // Rate limit errors are handled separately.\n\n  // Retry on request timeouts.\n  if (status === 408) return true;\n  // Retry on lock timeouts.\n  if (status === 409) return true;\n  // Retry internal errors.\n  if (status >= 500) return true;\n\n  return false;\n};\n\nexport {\n  calcRateLimitRetryTimeout,\n  castToError,\n  debug,\n  defaultShouldRetry,\n  delay,\n  getCacheKeyHash,\n  isRunningInBrowser,\n  safelyInvokeCallbacks,\n  type Prettify,\n};\n","import { Logger } from \"./logger.interface\";\n\nclass LoggerManager {\n  private static logger: Logger | undefined;\n\n  static setLogger(logger: Logger | undefined): void {\n    this.logger = logger;\n  }\n\n  static getLogger(): Logger | undefined {\n    return this.logger;\n  }\n}\n\nexport { LoggerManager };\n","import { isRunningInBrowser } from \"../../utils/utils\";\nimport { Logger } from \"./logger.interface\";\n\nexport class ConsoleLogger implements Logger {\n  debug(message: string, ...params: any[]): void {\n    console.debug(message, ...params);\n  }\n\n  info(message: string, ...params: any[]): void {\n    console.info(message, ...params);\n  }\n\n  warn(message: string, ...params: any[]): void {\n    if (isRunningInBrowser()) {\n      console.warn(`%WARN: %c${message}`, \"color: yellow; font-weight: bold;\", \"\", ...params);\n    } else {\n      const yellow = \"\\x1b[33m\";\n      const reset = \"\\x1b[0m\";\n      console.warn(`${yellow}WARN:${reset} ${message}`, ...params);\n    }\n  }\n\n  error(message: string, ...params: any[]): void {\n    if (isRunningInBrowser()) {\n      console.error(`%ERROR: %c${message}`, \"color: lightcoral; font-weight: bold;\", \"\", ...params);\n    } else {\n      const red = \"\\x1b[91m\";\n      const reset = \"\\x1b[0m\";\n      console.error(`${red}ERROR:${reset} ${message}`, ...params);\n    }\n  }\n\n  critical(message: string, ...params: any[]): void {\n    if (isRunningInBrowser()) {\n      console.error(`%cCRITICAL: %c${message}`, \"color: red; font-weight: bold;\", \"\", ...params);\n    } else {\n      const redBold = \"\\x1b[31;1m\";\n      const reset = \"\\x1b[0m\";\n      console.error(`${redBold}CRITICAL:${reset} ${message}`, ...params);\n    }\n  }\n}\n","import { Context, context, Span, SpanStatusCode, trace } from \"@opentelemetry/api\";\n\nimport { GatewayCompleteChatRequest } from \"../../gateway.types\";\nimport { delay } from \"../../utils\";\nimport { HttpRequestError } from \"./../http-client\";\nimport { LoggerManager } from \"./../logger\";\nimport { TelemetryManager } from \"./../telemetry\";\nimport { QueueTaskTimeoutError } from \"./queue.error\";\nimport { Queue, QueueOptionsType, QueueTask } from \"./queue.interface\";\n\nclass SimpleQueue<Request, Response> implements Queue<Request, Response> {\n  private options: QueueOptionsType;\n  private activeTasks = 0;\n  private queue: { task: QueueTask<Request, Response>; taskSpan: Span }[] = [];\n\n  constructor(options: QueueOptionsType) {\n    this.options = options;\n  }\n\n  public enqueue(task: QueueTask<Request, Response>): void {\n    const logger = LoggerManager.getLogger();\n    logger?.debug(`SimpleQueue.enqueue invoked, id: ${task.id}`);\n    context.with(task.telemetryContext, async () => {\n      const tracer = TelemetryManager.getTracer();\n      return tracer.startActiveSpan(\"queue.task.pickup-wait\", async (taskSpan: Span) => {\n        taskSpan.setAttribute(\"id\", task.id);\n        this.queue.push({ task, taskSpan });\n        logger?.debug(`SimpleQueue.enqueue task enqueued, id: ${task.id}`);\n      });\n    });\n    this.processQueue();\n  }\n\n  private executeWithTimeout(task: QueueTask<Request, Response>, taskTelemetryContext: Context): Promise<Response> {\n    const logger = LoggerManager.getLogger();\n    logger?.debug(`SimpleQueue.executeWithTimeout invoked with timeout: ${this.options.timeout}, id: ${task.id}`);\n    return new Promise((resolve, reject) => {\n      const timeout = setTimeout(() => {\n        logger?.warn(`SimpleQueue.executeWithTimeout timed out, id: ${task.id}`);\n        reject(\n          new QueueTaskTimeoutError({\n            info: \"Queue task timeout\",\n            cause: new Error(\"Queue task timeout\"),\n          })\n        );\n      }, this.options.timeout);\n\n      logger?.debug(`SimpleQueue.executeWithTimeout task executing, id: ${task.id}`);\n      task\n        .execute(task.request, taskTelemetryContext)\n        .then((result) => {\n          logger?.debug(`SimpleQueue.executeWithTimeout task completed, id: ${task.id}`);\n          clearTimeout(timeout);\n          resolve(result);\n        })\n        .catch((error) => {\n          logger?.warn(`SimpleQueue.executeWithTimeout task errored, id: ${task.id}`);\n          clearTimeout(timeout);\n          reject(error);\n        });\n    });\n  }\n\n  private async executeWithRetry(task: QueueTask<Request, Response>, retryRemaining: number): Promise<Response> {\n    const logger = LoggerManager.getLogger();\n    return await context.with(task.telemetryContext, async () => {\n      const tracer = TelemetryManager.getTracer();\n      return await tracer.startActiveSpan(\"queue.task.execute\", async (span: Span) => {\n        logger?.debug(`SimpleQueue.executeWithRetry invoked, attempt: ${this.options.retryCount - retryRemaining}, id: ${task.id}`);\n        span.setAttribute(\"attempt\", this.options.retryCount - retryRemaining);\n        try {\n          const taskTelemetryContext = context.active();\n          const response = await this.executeWithTimeout(task, taskTelemetryContext);\n          span.setStatus({ code: SpanStatusCode.OK });\n          span.end();\n          return response;\n        } catch (error) {\n          if (retryRemaining === 0) {\n            logger?.warn(`SimpleQueue.executeWithRetry retry count reached, id: ${task.id}`);\n            // span.setStatus({ code: SpanStatusCode.ERROR });\n            span.end();\n            throw error;\n          }\n\n          let shouldRetry = true;\n          let delayMs =\n            this.options.retry.initialDelay * Math.pow(this.options.retry.exponentialFactor, this.options.retryCount - retryRemaining);\n          if (HttpRequestError.isHttpRequestError(error)) {\n            // rate limiting error\n            if (error.cause.status === 429) {\n              logger?.warn(`SimpleQueue.executeWithRetry rate limiting error, id: ${task.id}`);\n              const taskRequest = GatewayCompleteChatRequest.safeParse(task.request);\n              if (taskRequest.success) {\n                const retryDelay = taskRequest.data.model.getRetryDelay(error.cause.headers);\n                shouldRetry = retryDelay.shouldRetry;\n                // valid delayMs is returned from model\n                if (retryDelay.delayMs > 0) {\n                  delayMs = retryDelay.delayMs;\n                }\n              }\n            }\n\n            if (error.cause.status >= 500 && error.cause.status < 600) {\n              logger?.warn(`SimpleQueue.executeWithRetry ${error.cause.status} error, id: ${task.id}`);\n              // implement retry logic for 500 errors\n              // else defaults to exponential backoff\n            }\n          } else {\n            logger?.warn(`SimpleQueue.executeWithRetry non http-request error, id: ${task.id}`, { error });\n            // implement retry logic for non http-request errors\n            // else defaults to exponential backoff\n          }\n\n          if (!shouldRetry) {\n            // span.setStatus({ code: SpanStatusCode.ERROR });\n            logger?.warn(`SimpleQueue.executeWithRetry model returned should not retry, id: ${task.id}`);\n            span.end();\n            throw error;\n          } else {\n            // span.setStatus({ code: SpanStatusCode.ERROR });\n            return await tracer.startActiveSpan(\"queue.task.retry-wait\", async (retrySpan: Span) => {\n              logger?.debug(`SimpleQueue.executeWithRetry retry wait: ${delayMs}ms, id: ${task.id}`);\n              await delay(delayMs);\n              retrySpan.end();\n              span.end();\n              return this.executeWithRetry(task, retryRemaining - 1);\n            });\n          }\n        } finally {\n          // span.end();\n        }\n      });\n    });\n  }\n\n  private async processQueue() {\n    const logger = LoggerManager.getLogger();\n    if (this.activeTasks >= this.options.maxConcurrentTasks) {\n      logger?.debug(\"SimpleQueue.processQueue max concurrent tasks reached\");\n      return;\n    }\n\n    const item = this.queue.shift();\n    if (!item) {\n      logger?.debug(\"SimpleQueue.processQueue no item to process\");\n      return;\n    }\n\n    const { task, taskSpan } = item;\n    if (taskSpan) {\n      taskSpan.end();\n    }\n\n    this.activeTasks += 1;\n    logger?.debug(`SimpleQueue.processQueue active tasks: ${this.activeTasks}`);\n    logger?.debug(`SimpleQueue.processQueue processing task, id: ${task.id}`);\n\n    try {\n      const response: Response = await this.executeWithRetry(task, this.options.retryCount);\n      logger?.debug(`SimpleQueue.processQueue task completed, id: ${task.id}`);\n      task.resolve(response);\n    } catch (error) {\n      logger?.warn(`SimpleQueue.processQueue task errored, id: ${task.id}`);\n      task.reject(error);\n    } finally {\n      this.activeTasks -= 1;\n      logger?.debug(`SimpleQueue.processQueue active tasks: ${this.activeTasks}`);\n      trace.getSpan(task.telemetryContext)?.end();\n      this.processQueue();\n    }\n  }\n}\n\nexport { SimpleQueue };\n","import { LRUCache as LRU } from \"lru-cache\";\n\nimport { LoggerManager } from \"./../logger\";\nimport { type Cache } from \"./cache.interface\";\n\nclass LRUCache<T extends object> implements Cache<T> {\n  private cache: LRU<string, T>;\n\n  constructor(maxEntries: number = 1000) {\n    this.cache = new LRU<string, T>({\n      max: maxEntries,\n      allowStale: false,\n      updateAgeOnGet: false,\n    });\n    const logger = LoggerManager.getLogger();\n    logger?.debug(`LRUCache initialized with maxEntries: ${maxEntries}`);\n  }\n\n  async get(key: string): Promise<T | undefined> {\n    const logger = LoggerManager.getLogger();\n    logger?.debug(`LRUCache.get invoked, key: ${key}`);\n    return new Promise((resolve) => {\n      const value = this.cache.get(key);\n      logger?.debug(\"LRUCache.get completed, value: \", value);\n      resolve(value);\n    });\n  }\n\n  async set(key: string, value: T): Promise<void> {\n    const logger = LoggerManager.getLogger();\n    logger?.debug(`LRUCache.set invoked, key: ${key}, value: `, value);\n    return new Promise((resolve) => {\n      this.cache.set(key, value);\n      logger?.debug(\"LRUCache.set completed\");\n      resolve();\n    });\n  }\n\n  async delete(key: string): Promise<void> {\n    const logger = LoggerManager.getLogger();\n    logger?.debug(`LRUCache.delete invoked, key: ${key}`);\n    return new Promise((resolve) => {\n      this.cache.delete(key);\n      logger?.debug(\"LRUCache.delete completed\");\n      resolve();\n    });\n  }\n\n  async clear(): Promise<void> {\n    const logger = LoggerManager.getLogger();\n    logger?.debug(\"LRUCache.clear invoked\");\n    return new Promise((resolve) => {\n      this.cache.clear();\n      logger?.debug(\"LRUCache.clear completed\");\n      resolve();\n    });\n  }\n}\n\nexport { LRUCache, type Cache };\n","import { AnalyticsEvent, AnalyticsRecorder } from \"./analytics.interface\";\n\nclass NoOpAnalytics implements AnalyticsRecorder {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  record(event: AnalyticsEvent[\"event\"], status: AnalyticsEvent[\"status\"], dimensions: AnalyticsEvent[\"dimensions\"]): void {\n    // Do nothing\n  }\n\n  stopRecorder(): void {\n    // Do nothing\n  }\n}\n\nexport { NoOpAnalytics };\n","import os from \"os\";\n\nimport { AnalyticsBrowserEnvironment, AnalyticsNodeEnvironment } from \"./analytics.interface\";\n\nconst getGatewayEnvironment = (): string => {\n  return process.env.ADX_NODE_ENV || \"unknown\";\n};\n\nconst getNodeDetails = (): AnalyticsNodeEnvironment => {\n  return {\n    node: {\n      version: process.version,\n      platform: os.platform(),\n      architecture: os.arch(),\n    },\n  };\n};\n\nconst getBrowserDetails = (): AnalyticsBrowserEnvironment => {\n  return {\n    browser: {\n      version: navigator.userAgent,\n      userAgent: navigator.userAgent,\n    },\n  };\n};\n\nexport { getBrowserDetails, getGatewayEnvironment, getNodeDetails };\n","import axios from \"axios\";\n\nimport { isRunningInBrowser } from \"./../../utils\";\nimport { AnalyticsBrowserEnvironment, AnalyticsEvent, AnalyticsNodeEnvironment, AnalyticsRecorder } from \"./analytics.interface\";\nimport { getBrowserDetails, getNodeDetails } from \"./analytics.utils\";\n\nclass PostAnalytics implements AnalyticsRecorder {\n  private readonly eventVersion = \"0.1\";\n  private readonly gatewayVersion = __LIBRARY_VERSION__;\n\n  private flushTimer: any;\n  private flushInterval: number = 10000;\n  private batchSize: number = 1;\n  private maxAttempts: number = 3;\n  private environment: AnalyticsNodeEnvironment | AnalyticsBrowserEnvironment = isRunningInBrowser()\n    ? getBrowserDetails()\n    : getNodeDetails();\n  private analyticsEndpointUrl: string = \"https://j954t34pkh.execute-api.us-east-1.amazonaws.com/v0/analytics\";\n\n  private events: { event: AnalyticsEvent; attempt: number }[] = [];\n\n  constructor() {\n    // this.startFlushTimer();\n  }\n\n  private startFlushTimer() {\n    if (isRunningInBrowser()) {\n      this.flushTimer = window.setInterval(() => this.flushEvents(), this.flushInterval);\n    } else {\n      this.flushTimer = setInterval(() => this.flushEvents(), this.flushInterval);\n    }\n  }\n\n  private stopFlushTimer() {\n    if (isRunningInBrowser()) {\n      window.clearInterval(this.flushTimer);\n    } else {\n      clearInterval(this.flushTimer);\n    }\n  }\n\n  record(event: AnalyticsEvent[\"event\"], status: AnalyticsEvent[\"status\"], dimensions: AnalyticsEvent[\"dimensions\"]): void {\n    const analyticsEvent: AnalyticsEvent = {\n      event,\n      status,\n      dimensions,\n      timestamp: new Date().toISOString(),\n      eventVersion: this.eventVersion,\n      gatewayVersion: this.gatewayVersion,\n      environment: this.environment,\n    };\n    this.events.push({ event: analyticsEvent, attempt: 0 });\n\n    if (this.events.length >= this.batchSize) {\n      this.flushEvents();\n    }\n  }\n\n  private async flushEvents(): Promise<void> {\n    if (this.events.length === 0) return;\n\n    const eventsToSend = [...this.events];\n    this.events = [];\n\n    const success = await this.sendEvents(eventsToSend.map((e) => e.event));\n    if (!success) {\n      this.events.push(\n        ...eventsToSend.filter((e) => e.attempt < this.maxAttempts).map((e) => ({ event: e.event, attempt: e.attempt + 1 }))\n      );\n    }\n  }\n\n  private async sendEvents(events: AnalyticsEvent[]): Promise<boolean> {\n    try {\n      const response = await axios.post(\n        this.analyticsEndpointUrl,\n        { events },\n        {\n          headers: {\n            \"Content-Type\": \"application/json\",\n          },\n        }\n      );\n      return response.status === 200;\n    } catch {\n      return false;\n    }\n  }\n\n  public stopRecorder() {\n    this.stopFlushTimer();\n    this.flushEvents();\n  }\n}\n\nexport { PostAnalytics };\n","import { AnalyticsRecorder } from \"./analytics.interface\";\nimport { NoOpAnalytics } from \"./no-op.analytics\";\nimport { PostAnalytics } from \"./post.analytics\";\n\nclass AnalyticsManager {\n  private static analytics: AnalyticsRecorder | undefined;\n\n  static getAnalyticsRecorder(enableAnalytics: boolean): AnalyticsRecorder {\n    if (this.analytics !== undefined) {\n      return this.analytics;\n    } else {\n      this.analytics = enableAnalytics ? new PostAnalytics() : new NoOpAnalytics();\n      return this.analytics;\n    }\n  }\n}\n\nexport { AnalyticsManager };\n","import { Meter, Tracer } from \"@opentelemetry/api\";\nimport { z } from \"zod\";\n\nimport { ChatModelV1, EmbeddingModelV1 } from \"@adaline/provider\";\nimport { ChatModelPriceType, ChatUsageType, Config, EmbeddingRequests, Message, Tool } from \"@adaline/types\";\n\nimport {\n  CompleteChatCallbackType,\n  CompleteChatHandlerResponseType,\n  GetEmbeddingsCallbackType,\n  GetEmbeddingsHandlerResponseType,\n  StreamChatCallbackType,\n} from \"./handlers\";\nimport { Cache, HttpClient, Logger, QueueOptions } from \"./plugins\";\n\nconst GatewayOptions = z.object({\n  queueOptions: z.lazy(() => QueueOptions.partial()).optional(),\n  dangerouslyAllowBrowser: z.boolean().optional(),\n  httpClient: z.custom<HttpClient>().optional(),\n  completeChatCache: z.custom<Cache<CompleteChatHandlerResponseType>>().optional(),\n  completeChatCallbacks: z.array(z.custom<CompleteChatCallbackType>()).nonempty().optional(),\n  getEmbeddingsCache: z.custom<Cache<GetEmbeddingsHandlerResponseType>>().optional(),\n  getEmbeddingsCallbacks: z.array(z.custom<GetEmbeddingsCallbackType>()).nonempty().optional(),\n  streamChatCallbacks: z.array(z.custom<StreamChatCallbackType>()).nonempty().optional(),\n  logger: z.custom<Logger>().optional(),\n  telemetry: z\n    .object({\n      tracer: z.custom<Tracer>().optional(),\n      meter: z.custom<Meter>().optional(),\n    })\n    .optional(),\n  enableAnalytics: z.boolean().optional(),\n  enableProxyAgent: z.boolean().optional(),\n});\ntype GatewayOptionsType = z.infer<typeof GatewayOptions>;\n\nconst GatewayCompleteChatRequestOptions = z.object({\n  enableCache: z.boolean().optional().default(true),\n  customHeaders: z.record(z.string()).optional(),\n  metadataForCallbacks: z.any().optional(),\n});\ntype GatewayCompleteChatRequestOptionsType = z.infer<typeof GatewayCompleteChatRequestOptions>;\n\nconst GatewayCompleteChatRequest = z.object({\n  model: z.custom<ChatModelV1>(),\n  config: Config(),\n  messages: z.array(Message()),\n  tools: z.array(Tool()).optional(),\n  options: GatewayCompleteChatRequestOptions.optional(),\n});\ntype GatewayCompleteChatRequestType = z.infer<typeof GatewayCompleteChatRequest>;\n\nconst GatewayStreamChatRequestOptions = z.object({\n  customHeaders: z.record(z.string()).optional(),\n  metadataForCallbacks: z.any().optional(),\n});\ntype GatewayStreamChatRequestOptionsType = z.infer<typeof GatewayStreamChatRequestOptions>;\n\nconst GatewayStreamChatRequest = z.object({\n  model: z.custom<ChatModelV1>(),\n  config: Config(),\n  messages: z.array(Message()),\n  tools: z.array(Tool()).optional(),\n  options: GatewayStreamChatRequestOptions.optional(),\n  abortSignal: z.instanceof(AbortSignal).optional(),\n});\n\ntype GatewayStreamChatRequestType = z.infer<typeof GatewayStreamChatRequest>;\n\nconst GatewayGetEmbeddingsRequestOptions = z.object({\n  enableCache: z.boolean().optional().default(true),\n  customHeaders: z.record(z.string()).optional(),\n  metadataForCallbacks: z.any().optional(),\n});\ntype GatewayGetEmbeddingsRequestOptionsType = z.infer<typeof GatewayGetEmbeddingsRequestOptions>;\n\nconst GatewayGetEmbeddingsRequest = z.object({\n  model: z.custom<EmbeddingModelV1>(),\n  config: Config(),\n  embeddingRequests: EmbeddingRequests(),\n  options: GatewayGetEmbeddingsRequestOptions.optional(),\n});\ntype GatewayGetEmbeddingsRequestType = z.infer<typeof GatewayGetEmbeddingsRequest>;\n\nconst GatewayProxyCompleteChatRequest = z.object({\n  model: z.custom<ChatModelV1>(),\n  data: z.any(),\n  headers: z.record(z.string()),\n  query: z.record(z.string()).optional(),\n});\ntype GatewayProxyCompleteChatRequestType = z.infer<typeof GatewayProxyCompleteChatRequest>;\n\nconst GatewayProxyStreamChatRequest = z.object({\n  model: z.custom<ChatModelV1>(),\n  data: z.any(),\n  headers: z.record(z.string()),\n  query: z.record(z.string()).optional(),\n});\ntype GatewayProxyStreamChatRequestType = z.infer<typeof GatewayProxyStreamChatRequest>;\n\nconst GatewayProxyGetEmbeddingsRequest = z.object({\n  model: z.custom<EmbeddingModelV1>(),\n  data: z.any(),\n  headers: z.record(z.string()),\n  query: z.record(z.string()).optional(),\n});\ntype GatewayProxyGetEmbeddingsRequestType = z.infer<typeof GatewayProxyGetEmbeddingsRequest>;\n\nconst GatewayGetChatUsageCostRequest = z\n  .object({\n    chatUsage: z.custom<ChatUsageType>(),\n    chatModelPrice: z.custom<ChatModelPriceType>().optional(),\n    model: z.custom<ChatModelV1>().optional(),\n  })\n  .refine(\n    (data) => {\n      // Ensure exactly one of chatModelPrice or model is provided\n      return (data.chatModelPrice !== undefined) !== (data.model !== undefined);\n    },\n    {\n      message: \"Exactly one of chatModelPrice or model must be provided, not both.\",\n      path: [\"chatModelPrice\", \"model\"],\n    }\n  );\ntype GatewayGetChatUsageCostRequestType = z.infer<typeof GatewayGetChatUsageCostRequest>;\n\nexport {\n  GatewayCompleteChatRequest,\n  GatewayCompleteChatRequestOptions,\n  GatewayGetChatUsageCostRequest,\n  GatewayGetEmbeddingsRequest,\n  GatewayGetEmbeddingsRequestOptions,\n  GatewayOptions,\n  GatewayProxyCompleteChatRequest,\n  GatewayProxyGetEmbeddingsRequest,\n  GatewayProxyStreamChatRequest,\n  GatewayStreamChatRequest,\n  GatewayStreamChatRequestOptions,\n  type GatewayCompleteChatRequestOptionsType,\n  type GatewayCompleteChatRequestType,\n  type GatewayGetChatUsageCostRequestType,\n  type GatewayGetEmbeddingsRequestOptionsType,\n  type GatewayGetEmbeddingsRequestType,\n  type GatewayOptionsType,\n  type GatewayProxyCompleteChatRequestType,\n  type GatewayProxyGetEmbeddingsRequestType,\n  type GatewayProxyStreamChatRequestType,\n  type GatewayStreamChatRequestOptionsType,\n  type GatewayStreamChatRequestType,\n};\n","import { Context, context, Span, SpanStatusCode } from \"@opentelemetry/api\";\n\nimport { GatewayError } from \"../../errors/errors\";\nimport { HttpClient, HttpRequestError, LoggerManager, TelemetryManager } from \"../../plugins\";\nimport { castToError, getCacheKeyHash, isRunningInBrowser, safelyInvokeCallbacks } from \"../../utils\";\nimport {\n  CompleteChatCallbackType,\n  CompleteChatHandlerRequest,\n  CompleteChatHandlerRequestType,\n  CompleteChatHandlerResponseType,\n} from \"./complete-chat.types\";\n\nasync function handleCompleteChat(\n  request: CompleteChatHandlerRequestType,\n  client: HttpClient,\n  telemetryContext?: Context\n): Promise<CompleteChatHandlerResponseType> {\n  const logger = LoggerManager.getLogger();\n  const _handleCompleteChat = async (span?: Span) => {\n    logger?.debug(\"handleCompleteChat invoked\");\n    logger?.debug(\"handleCompleteChat request: \", { request });\n    const data = CompleteChatHandlerRequest.parse(request);\n    const callbacks = request.callbacks || [];\n    const handlerTelemetryContext = context.active();\n\n    try {\n      safelyInvokeCallbacks<CompleteChatCallbackType, keyof CompleteChatCallbackType>(\n        callbacks,\n        \"onChatStart\",\n        request.metadataForCallbacks\n      );\n\n      const providerData = {\n        config: data.config,\n        messages: data.messages,\n        tools: data.tools,\n      };\n\n      const providerRequest = {\n        url: await data.model.getCompleteChatUrl(data.config, data.messages, data.tools),\n        headers: await data.model.getCompleteChatHeaders(data.config, data.messages, data.tools),\n        data: await data.model.getCompleteChatData(data.config, data.messages, data.tools),\n      };\n\n      if (!isRunningInBrowser()) {\n        providerRequest.headers = {\n          ...providerRequest.headers,\n          source: \"adaline.ai\",\n        };\n      }\n      if (data.customHeaders) {\n        providerRequest.headers = {\n          ...providerRequest.headers,\n          ...data.customHeaders,\n        };\n      }\n\n      logger?.debug(\"handleCompleteChat providerRequest: \", { providerRequest });\n      const cacheKey = getCacheKeyHash(`complete-chat:${providerRequest.url}:${data.model.modelSchema.name}`, providerData);\n      if (data.enableCache) {\n        logger?.debug(\"handleCompleteChat checking cache\");\n        const cachedResponse = await request.cache.get(cacheKey);\n        if (cachedResponse) {\n          cachedResponse.cached = true;\n          logger?.debug(\"handleCompleteChat cached hit\");\n          span?.setAttribute(\"cached\", true);\n          span?.setStatus({ code: SpanStatusCode.OK });\n          safelyInvokeCallbacks<CompleteChatCallbackType, keyof CompleteChatCallbackType>(\n            callbacks,\n            \"onChatCached\",\n            request.metadataForCallbacks,\n            cachedResponse\n          );\n          logger?.debug(\"handleCompleteChat cached response: \", { cachedResponse });\n          return cachedResponse;\n        }\n      }\n\n      logger?.debug(\"handleCompleteChat cache miss\");\n      const now = Date.now();\n      const providerResponse = await client.post(\n        providerRequest.url,\n        providerRequest.data,\n        providerRequest.headers,\n        handlerTelemetryContext\n      );\n      const latencyInMs = Date.now() - now;\n      logger?.debug(\"handleCompleteChat providerResponse: \", { providerResponse });\n\n      const response: CompleteChatHandlerResponseType = {\n        request: providerData,\n        response: data.model.transformCompleteChatResponse(providerResponse.data),\n        cached: false,\n        latencyInMs,\n        metadataForCallbacks: request.metadataForCallbacks,\n        provider: {\n          request: providerRequest,\n          response: providerResponse,\n        },\n      };\n\n      logger?.debug(\"handleCompleteChat response: \", { response });\n      if (data.enableCache) {\n        await request.cache.set(cacheKey, response);\n        logger?.debug(\"handleCompleteChat response cached\");\n      }\n\n      span?.setAttribute(\"cached\", false);\n      span?.setStatus({ code: SpanStatusCode.OK });\n      safelyInvokeCallbacks<CompleteChatCallbackType, keyof CompleteChatCallbackType>(\n        callbacks,\n        \"onChatComplete\",\n        request.metadataForCallbacks,\n        response\n      );\n\n      return response;\n    } catch (error) {\n      logger?.warn(\"handleCompleteChat error: \", { error });\n      let safeError: GatewayError | HttpRequestError;\n\n      if (HttpRequestError.isHttpRequestError(error)) {\n        safeError = error;\n      } else if (error instanceof GatewayError) {\n        safeError = error;\n      } else {\n        safeError = castToError(error);\n      }\n\n      // TODO: maybe only set if it's non HTTP Error ?\n      // span?.setStatus({ code: SpanStatusCode.ERROR, message: safeError.message });\n      safelyInvokeCallbacks<CompleteChatCallbackType, keyof CompleteChatCallbackType>(\n        callbacks,\n        \"onChatError\",\n        request.metadataForCallbacks,\n        safeError\n      );\n\n      throw safeError;\n    } finally {\n      span?.end();\n    }\n  };\n\n  if (!telemetryContext) {\n    return await _handleCompleteChat();\n  }\n\n  return await context.with(telemetryContext, async () => {\n    const tracer = TelemetryManager.getTracer();\n    return await tracer.startActiveSpan(\"complete-chat.handler\", async (span: Span) => {\n      return await _handleCompleteChat(span);\n    });\n  });\n}\n\nexport { handleCompleteChat };\n","import { z } from \"zod\";\n\nimport { ChatModelV1 } from \"@adaline/provider\";\nimport { ChatResponse, Config, Message, Tool } from \"@adaline/types\";\n\nimport { GatewayError } from \"../../errors\";\nimport { Cache, HttpRequestError } from \"../../plugins\";\n\nconst CompleteChatHandlerRequest = z.object({\n  cache: z.custom<Cache<CompleteChatHandlerResponseType>>(),\n  model: z.custom<ChatModelV1>(),\n  config: Config(),\n  messages: z.array(Message()),\n  tools: z.array(Tool()).optional(),\n  enableCache: z.boolean(),\n  customHeaders: z.record(z.string()).optional(),\n  callbacks: z.array(z.custom<CompleteChatCallbackType>()).nonempty().optional(),\n  metadataForCallbacks: z.any().optional(),\n});\ntype CompleteChatHandlerRequestType = z.infer<typeof CompleteChatHandlerRequest>;\n\nconst CompleteChatHandlerResponse = z.object({\n  request: z.object({\n    config: Config(),\n    messages: z.array(Message()),\n    tools: z.array(Tool()).optional(),\n  }),\n  response: ChatResponse,\n  cached: z.boolean(),\n  latencyInMs: z.number().int().positive(),\n  metadataForCallbacks: z.any().optional(),\n  provider: z.object({\n    request: z.any(),\n    response: z.any(),\n  }),\n});\ntype CompleteChatHandlerResponseType = z.infer<typeof CompleteChatHandlerResponse>;\n\ntype CompleteChatCallbackType<M = any> = {\n  onChatStart?: (metadata?: M) => Promise<void> | void;\n  onChatCached?: (metadata?: M, response?: CompleteChatHandlerResponseType) => Promise<void> | void;\n  onChatComplete?: (metadata?: M, response?: CompleteChatHandlerResponseType) => Promise<void> | void;\n  onChatError?: (metadata?: M, error?: GatewayError | HttpRequestError) => Promise<void> | void;\n};\n\nexport {\n  CompleteChatHandlerRequest,\n  CompleteChatHandlerResponse,\n  type CompleteChatCallbackType,\n  type CompleteChatHandlerRequestType,\n  type CompleteChatHandlerResponseType,\n};\n","import { ChatModelPriceType } from \"@adaline/types\";\n\nimport { GatewayError } from \"../../errors\";\nimport { GetChatUsageCostHandlerRequestType, GetChatUsageCostHandlerResponseType } from \"./get-chat-usage-cost.types\";\n\nfunction handleGetChatUsageCost(request: GetChatUsageCostHandlerRequestType): GetChatUsageCostHandlerResponseType {\n  const { promptTokens, completionTokens } = request.chatUsage;\n  let tokenRanges: ChatModelPriceType;\n  if (request.chatModelPrice) {\n    tokenRanges = request.chatModelPrice;\n  } else if (request.model) {\n    tokenRanges = request.model.getModelPricing();\n  } else {\n    throw new GatewayError(\"No chatModelPrice or model provided\");\n  }\n\n  // Helper: pick the per‑million rate for either input or output\n  function getRate(tokens: number, kind: \"inputPricePerMillion\" | \"outputPricePerMillion\"): number {\n    const tokenRange = tokenRanges.tokenRanges.find(\n      (t) => tokens >= t.minTokens && (t.maxTokens === null || t.maxTokens === undefined || tokens < t.maxTokens)\n    );\n    if (!tokenRange) {\n      throw new GatewayError(\"Unable to find a pricing tier for the given token count. Please check your model pricing configuration.\");\n    }\n    const rate = tokenRange.prices?.base?.[kind];\n    if (rate === undefined) {\n      throw new GatewayError(`Unable to find a pricing rate for the given token count. Please check your model pricing configuration.`);\n    }\n    return rate;\n  }\n\n  const inputRatePerMillion = getRate(promptTokens, \"inputPricePerMillion\");\n  const outputRatePerMillion = getRate(promptTokens, \"outputPricePerMillion\");\n\n  // rates are per‑1,000,000 tokens\n  const inputCost = Number(((promptTokens / 1_000_000) * inputRatePerMillion).toFixed(6));\n  const outputCost = Number(((completionTokens / 1_000_000) * outputRatePerMillion).toFixed(6));\n  const totalCost = inputCost + outputCost;\n  return {\n    cost: totalCost,\n    currency: tokenRanges.currency || \"USD\", // Default to USD if currency is not provided\n    pricingModel: tokenRanges,\n    usageTokens: request.chatUsage,\n  };\n}\n\nexport { handleGetChatUsageCost };\n","import { z } from \"zod\";\n\nimport { EmbeddingModelV1 } from \"@adaline/provider\";\nimport { Config, EmbeddingRequests, EmbeddingResponse } from \"@adaline/types\";\n\nimport { GatewayError } from \"../../errors\";\nimport { Cache, HttpRequestError } from \"../../plugins\";\n\nconst GetEmbeddingsHandlerRequest = z.object({\n  cache: z.custom<Cache<GetEmbeddingsHandlerResponseType>>(),\n  model: z.custom<EmbeddingModelV1>(),\n  config: Config(),\n  embeddingRequests: EmbeddingRequests(),\n  enableCache: z.boolean(),\n  customHeaders: z.record(z.string()).optional(),\n  callbacks: z.array(z.custom<GetEmbeddingsCallbackType>()).nonempty().optional(),\n  metadataForCallbacks: z.any().optional(),\n});\ntype GetEmbeddingsHandlerRequestType = z.infer<typeof GetEmbeddingsHandlerRequest>;\n\nconst GetEmbeddingsHandlerResponse = z.object({\n  request: z.object({\n    config: Config(),\n    embeddingRequests: EmbeddingRequests(),\n  }),\n  response: EmbeddingResponse,\n  cached: z.boolean(),\n  latencyInMs: z.number().int().positive(),\n  metadataForCallbacks: z.any().optional(),\n  provider: z.object({\n    request: z.any(),\n    response: z.any(),\n  }),\n});\ntype GetEmbeddingsHandlerResponseType = z.infer<typeof GetEmbeddingsHandlerResponse>;\n\ntype GetEmbeddingsCallbackType<M = any> = {\n  onGetEmbeddingsStart?: (metadata?: M) => Promise<void> | void;\n  onGetEmbeddingsCached?: (metadata?: M, response?: GetEmbeddingsHandlerResponseType) => Promise<void> | void;\n  onGetEmbeddingsComplete?: (metadata?: M, response?: GetEmbeddingsHandlerResponseType) => Promise<void> | void;\n  onGetEmbeddingsError?: (metadata?: M, error?: GatewayError | HttpRequestError) => Promise<void> | void;\n};\n\nexport {\n  GetEmbeddingsHandlerRequest,\n  GetEmbeddingsHandlerResponse,\n  type GetEmbeddingsHandlerRequestType,\n  type GetEmbeddingsHandlerResponseType,\n  type GetEmbeddingsCallbackType,\n};\n","import { Context, context, Span, SpanStatusCode } from \"@opentelemetry/api\";\n\nimport { GatewayError } from \"../../errors/errors\";\nimport { HttpClient, HttpRequestError, LoggerManager, TelemetryManager } from \"../../plugins\";\nimport { castToError, getCacheKeyHash, isRunningInBrowser, safelyInvokeCallbacks } from \"../../utils\";\nimport {\n  GetEmbeddingsCallbackType,\n  GetEmbeddingsHandlerRequest,\n  GetEmbeddingsHandlerRequestType,\n  GetEmbeddingsHandlerResponseType,\n} from \"./get-embeddings.types\";\n\nasync function handleGetEmbeddings(\n  request: GetEmbeddingsHandlerRequestType,\n  client: HttpClient,\n  telemetryContext?: Context\n): Promise<GetEmbeddingsHandlerResponseType> {\n  const logger = LoggerManager.getLogger();\n  const _handleGetEmbeddings = async (span?: Span) => {\n    logger?.debug(\"handleGetEmbeddings invoked\");\n    logger?.debug(\"handleGetEmbeddings request: \", { request });\n    const data = GetEmbeddingsHandlerRequest.parse(request);\n    const callbacks = request.callbacks || [];\n    const handlerTelemetryContext = context.active();\n\n    try {\n      safelyInvokeCallbacks<GetEmbeddingsCallbackType, keyof GetEmbeddingsCallbackType>(\n        callbacks,\n        \"onGetEmbeddingsStart\",\n        request.metadataForCallbacks\n      );\n\n      const providerData = {\n        config: data.config,\n        embeddingRequests: data.embeddingRequests,\n      };\n\n      const providerRequest = {\n        url: await data.model.getGetEmbeddingsUrl(data.config, data.embeddingRequests),\n        headers: await data.model.getGetEmbeddingsHeaders(data.config, data.embeddingRequests),\n        data: await data.model.getGetEmbeddingsData(data.config, data.embeddingRequests),\n      };\n\n      if (!isRunningInBrowser()) {\n        providerRequest.headers = {\n          ...providerRequest.headers,\n          source: \"adaline.ai\",\n        };\n      }\n\n      if (data.customHeaders) {\n        providerRequest.headers = {\n          ...providerRequest.headers,\n          ...data.customHeaders,\n        };\n      }\n\n      logger?.debug(\"handleGetEmbeddings providerRequest: \", { providerRequest });\n      const cacheKey = getCacheKeyHash(`get-embeddings:${providerRequest.url}:${data.model.modelSchema.name}`, providerData);\n      if (data.enableCache) {\n        logger?.debug(\"handleGetEmbeddings checking cache\");\n        const cachedResponse = await request.cache.get(cacheKey);\n        if (cachedResponse) {\n          cachedResponse.cached = true;\n          logger?.debug(\"handleGetEmbeddings cached hit\");\n          span?.setAttribute(\"cached\", true);\n          span?.setStatus({ code: SpanStatusCode.OK });\n          safelyInvokeCallbacks<GetEmbeddingsCallbackType, keyof GetEmbeddingsCallbackType>(\n            callbacks,\n            \"onGetEmbeddingsCached\",\n            request.metadataForCallbacks,\n            cachedResponse\n          );\n          logger?.debug(\"handleGetEmbeddings cached response: \", { cachedResponse });\n          return cachedResponse;\n        }\n      }\n\n      logger?.debug(\"handleGetEmbeddings cache miss\");\n      const now = Date.now();\n      const providerResponse = await client.post(\n        providerRequest.url,\n        providerRequest.data,\n        providerRequest.headers,\n        handlerTelemetryContext\n      );\n      const latencyInMs = Date.now() - now;\n      logger?.debug(\"handleGetEmbeddings providerResponse: \", { providerResponse });\n\n      const response: GetEmbeddingsHandlerResponseType = {\n        request: providerData,\n        response: data.model.transformGetEmbeddingsResponse(providerResponse.data),\n        cached: false,\n        latencyInMs,\n        metadataForCallbacks: request.metadataForCallbacks,\n        provider: {\n          request: providerRequest,\n          response: providerResponse,\n        },\n      };\n\n      logger?.debug(\"handleGetEmbeddings response: \", { response });\n      if (data.enableCache) {\n        await request.cache.set(cacheKey, response);\n        logger?.debug(\"handleGetEmbeddings response cached\");\n      }\n\n      span?.setAttribute(\"cached\", false);\n      span?.setStatus({ code: SpanStatusCode.OK });\n      safelyInvokeCallbacks<GetEmbeddingsCallbackType, keyof GetEmbeddingsCallbackType>(\n        callbacks,\n        \"onGetEmbeddingsComplete\",\n        request.metadataForCallbacks,\n        response\n      );\n\n      return response;\n    } catch (error) {\n      logger?.warn(\"handleGetEmbeddings error: \", { error });\n      let safeError: GatewayError | HttpRequestError;\n\n      if (HttpRequestError.isHttpRequestError(error)) {\n        safeError = error;\n      } else if (error instanceof GatewayError) {\n        safeError = error;\n      } else {\n        safeError = castToError(error);\n      }\n\n      // span?.setStatus({ code: SpanStatusCode.ERROR, message: safeError.message });\n      safelyInvokeCallbacks<GetEmbeddingsCallbackType, keyof GetEmbeddingsCallbackType>(\n        callbacks,\n        \"onGetEmbeddingsError\",\n        request.metadataForCallbacks,\n        safeError\n      );\n\n      throw safeError;\n    } finally {\n      span?.end();\n    }\n  };\n\n  if (!telemetryContext) {\n    return await _handleGetEmbeddings();\n  }\n\n  return await context.with(telemetryContext, async () => {\n    const tracer = TelemetryManager.getTracer();\n    return await tracer.startActiveSpan(\"get-embeddings.handler\", async (span: Span) => {\n      return await _handleGetEmbeddings(span);\n    });\n  });\n}\n\nexport { handleGetEmbeddings };\n","import { z } from \"zod\";\n\nimport { ChatModelV1 } from \"@adaline/provider\";\nimport { ChatResponse } from \"@adaline/types\";\n\nconst ProxyCompleteChatHandlerRequest = z.object({\n  model: z.custom<ChatModelV1>(),\n  data: z.any(),\n  headers: z.record(z.string()),\n  query: z.record(z.string()).optional(),\n});\n\ntype ProxyCompleteChatHandlerRequestType = z.infer<typeof ProxyCompleteChatHandlerRequest>;\n\nconst ProxyCompleteChatHandlerResponse = z.object({\n  request: z.any(), // original proxy request from some SDK\n  providerRequest: z.object({\n    url: z.string().url(),\n    headers: z.record(z.string()),\n    data: z.any(),\n  }), // request sent to provider\n  providerResponse: z.any(), // response received from provider\n  transformedResponse: z.optional(ChatResponse), // response received in Adaline chat types\n});\ntype ProxyCompleteChatHandlerResponseType = z.infer<typeof ProxyCompleteChatHandlerResponse>;\n\nexport {\n  ProxyCompleteChatHandlerRequest,\n  ProxyCompleteChatHandlerResponse,\n  type ProxyCompleteChatHandlerRequestType,\n  type ProxyCompleteChatHandlerResponseType,\n};\n","import { Context, context, Span, SpanStatusCode } from \"@opentelemetry/api\";\n\nimport { GatewayError } from \"../../errors/errors\";\nimport { HttpClient, HttpRequestError, LoggerManager, TelemetryManager } from \"../../plugins\";\nimport { castToError } from \"../../utils\";\nimport type { ProxyCompleteChatHandlerRequestType, ProxyCompleteChatHandlerResponseType } from \"./proxy-complete-chat.types\";\nimport { ProxyCompleteChatHandlerRequest } from \"./proxy-complete-chat.types\";\n\nasync function handleProxyCompleteChat(\n  request: ProxyCompleteChatHandlerRequestType,\n  client: HttpClient,\n  telemetryContext?: Context\n): Promise<ProxyCompleteChatHandlerResponseType> {\n  const logger = LoggerManager.getLogger();\n  const _handleProxyCompleteChat = async (span?: Span) => {\n    logger?.debug(\"handleProxyCompleteChat invoked\");\n    logger?.debug(\"handleProxyCompleteChat request: \", { request });\n    const data = ProxyCompleteChatHandlerRequest.parse(request);\n    const handlerTelemetryContext = context.active();\n\n    try {\n      data.headers = { ...data.headers, source: \"adaline.ai\" };\n\n      const providerRequest = {\n        url: await data.model.getProxyCompleteChatUrl(data.data, data.headers, data.query),\n        headers: await data.model.getProxyCompleteChatHeaders(data.data, data.headers, data.query),\n        data: data.data,\n      };\n      logger?.debug(\"handleProxyCompleteChat providerRequest: \", { providerRequest });\n\n      const providerResponse = await client.post(\n        providerRequest.url,\n        providerRequest.data,\n        providerRequest.headers,\n        handlerTelemetryContext\n      );\n      logger?.debug(\"handleProxyCompleteChat providerResponse: \", { providerResponse });\n\n      let transformedResponse;\n      try {\n        transformedResponse = data.model.transformCompleteChatResponse(providerResponse.data);\n      } catch (transformationError) {\n        logger?.warn(\"handleProxyCompleteChat transformation error: \", { transformationError });\n      }\n\n      const response: ProxyCompleteChatHandlerResponseType = {\n        request: { header: data.headers, data: data.data, query: data.query },\n        providerRequest: providerRequest,\n        providerResponse: providerResponse,\n        transformedResponse: transformedResponse,\n      };\n\n      logger?.debug(\"handleProxyCompleteChat response: \", { response });\n\n      span?.setStatus({ code: SpanStatusCode.OK });\n\n      return response;\n    } catch (error) {\n      logger?.warn(\"handleProxyCompleteChat error: \", { error });\n      let safeError: GatewayError | HttpRequestError;\n\n      if (HttpRequestError.isHttpRequestError(error)) {\n        safeError = error;\n      } else if (error instanceof GatewayError) {\n        safeError = error;\n      } else {\n        safeError = castToError(error);\n      }\n\n      throw safeError;\n    } finally {\n      span?.end();\n    }\n  };\n\n  if (!telemetryContext) {\n    return await _handleProxyCompleteChat();\n  }\n\n  return await context.with(telemetryContext, async () => {\n    const tracer = TelemetryManager.getTracer();\n    return await tracer.startActiveSpan(\"proxy-complete-chat.handler\", async (span: Span) => {\n      return await _handleProxyCompleteChat(span);\n    });\n  });\n}\n\nexport { handleProxyCompleteChat };\n","import { Context, context, Span, SpanStatusCode } from \"@opentelemetry/api\";\n\nimport { GatewayError } from \"../../errors/errors\";\nimport { HttpClient, HttpRequestError, LoggerManager, TelemetryManager } from \"../../plugins\";\nimport { castToError } from \"../../utils\";\nimport type { ProxyGetEmbeddingsHandlerRequestType, ProxyGetEmbeddingsHandlerResponseType } from \"./proxy-get-embeddings.types\";\nimport { ProxyGetEmbeddingsHandlerRequest } from \"./proxy-get-embeddings.types\";\n\nasync function handleProxyGetEmbeddings(\n  request: ProxyGetEmbeddingsHandlerRequestType,\n  client: HttpClient,\n  telemetryContext?: Context\n): Promise<ProxyGetEmbeddingsHandlerResponseType> {\n  const logger = LoggerManager.getLogger();\n  const _handleProxyGetEmbeddings = async (span?: Span) => {\n    logger?.debug(\"handleProxyGetEmbeddings invoked\");\n    logger?.debug(\"handleProxyGetEmbeddings request: \", { request });\n    const data = ProxyGetEmbeddingsHandlerRequest.parse(request);\n    const handlerTelemetryContext = context.active();\n\n    try {\n      const providerRequest = {\n        url: await data.model.getGetEmbeddingsUrl(),\n        headers: data.headers,\n        data: data.data,\n      };\n\n      providerRequest.headers = {\n        ...providerRequest.headers,\n        source: \"adaline.ai\",\n      };\n\n      const sanitizedProviderRequest = { ...providerRequest };\n      delete sanitizedProviderRequest.headers.host;\n      delete sanitizedProviderRequest.headers[\"content-length\"];\n\n      logger?.debug(\"handleProxyGetEmbeddings providerRequest: \", { providerRequest });\n\n      const providerResponse = await client.post(\n        sanitizedProviderRequest.url,\n        sanitizedProviderRequest.data,\n        sanitizedProviderRequest.headers,\n        handlerTelemetryContext\n      );\n      logger?.debug(\"handleProxyGetEmbeddings providerResponse: \", { providerResponse });\n\n      let transformedResponse;\n      try {\n        transformedResponse = data.model.transformGetEmbeddingsResponse(providerResponse.data);\n      } catch (transformationError) {\n        logger?.warn(\"handleProxyGetEmbeddings transformation error: \", { transformationError });\n      }\n\n      const response: ProxyGetEmbeddingsHandlerResponseType = {\n        request: providerRequest,\n        providerRequest: sanitizedProviderRequest,\n        providerResponse: providerResponse,\n        transformedResponse: transformedResponse,\n      };\n\n      logger?.debug(\"handleProxyGetEmbeddings response: \", { response });\n\n      span?.setStatus({ code: SpanStatusCode.OK });\n\n      return response;\n    } catch (error) {\n      logger?.warn(\"handleProxyGetEmbeddings error: \", { error });\n      let safeError: GatewayError | HttpRequestError;\n\n      if (HttpRequestError.isHttpRequestError(error)) {\n        safeError = error;\n      } else if (error instanceof GatewayError) {\n        safeError = error;\n      } else {\n        safeError = castToError(error);\n      }\n\n      throw safeError;\n    } finally {\n      span?.end();\n    }\n  };\n\n  if (!telemetryContext) {\n    return await _handleProxyGetEmbeddings();\n  }\n\n  return await context.with(telemetryContext, async () => {\n    const tracer = TelemetryManager.getTracer();\n    return await tracer.startActiveSpan(\"proxy-get-embeddings.handler\", async (span: Span) => {\n      return await _handleProxyGetEmbeddings(span);\n    });\n  });\n}\n\nexport { handleProxyGetEmbeddings };\n","import { z } from \"zod\";\n\nimport { EmbeddingModelV1 } from \"@adaline/provider\";\nimport { EmbeddingResponse } from \"@adaline/types\";\n\nconst ProxyGetEmbeddingsHandlerRequest = z.object({\n  model: z.custom<EmbeddingModelV1>(),\n  data: z.any(),\n  headers: z.record(z.string()),\n  query: z.record(z.string()).optional(),\n});\n\ntype ProxyGetEmbeddingsHandlerRequestType = z.infer<typeof ProxyGetEmbeddingsHandlerRequest>;\n\nconst ProxyGetEmbeddingsHandlerResponse = z.object({\n  request: z.any(), // Original proxy request from SDK\n  providerRequest: z.object({\n    url: z.string().url(),\n    headers: z.record(z.string()),\n    data: z.any(),\n  }), // Actual request sent to provider\n  providerResponse: z.any(), // Raw response from provider\n  transformedResponse: z.optional(EmbeddingResponse), // Response in Adaline embedding types\n});\n\ntype ProxyGetEmbeddingsHandlerResponseType = z.infer<typeof ProxyGetEmbeddingsHandlerResponse>;\n\nexport {\n  ProxyGetEmbeddingsHandlerRequest,\n  ProxyGetEmbeddingsHandlerResponse,\n  type ProxyGetEmbeddingsHandlerRequestType,\n  type ProxyGetEmbeddingsHandlerResponseType,\n};\n","import { Context, context, Span, SpanStatusCode } from \"@opentelemetry/api\";\n\nimport { PartialChatResponseType } from \"@adaline/types\";\n\nimport { GatewayError } from \"../../errors/errors\";\nimport { HttpClient, HttpRequestError, LoggerManager, TelemetryManager } from \"../../plugins\";\nimport { castToError } from \"../../utils\";\nimport type { ProxyStreamChatHandlerRequestType, ProxyStreamChatHandlerResponseType } from \"./proxy-stream-chat.types\";\nimport { ProxyStreamChatHandlerRequest } from \"./proxy-stream-chat.types\";\n\nasync function* handleProxyStreamChat(\n  request: ProxyStreamChatHandlerRequestType,\n  client: HttpClient,\n  telemetryContext?: Context\n): AsyncGenerator<ProxyStreamChatHandlerResponseType, void, unknown> {\n  const logger = LoggerManager.getLogger();\n  const _handleProxyStreamChat = async function* (span?: Span): AsyncGenerator<ProxyStreamChatHandlerResponseType, void, unknown> {\n    logger?.debug(\"handleProxyStreamChat invoked\");\n    logger?.debug(\"handleProxyStreamChat request: \", { request });\n    const handlerTelemetryContext = context.active();\n\n    const data = ProxyStreamChatHandlerRequest.parse(request);\n\n    try {\n      data.headers = { ...data.headers, source: \"adaline.ai\" };\n      const providerRequest = {\n        url: await data.model.getProxyStreamChatUrl(data.data, data.headers, data.query),\n        headers: await data.model.getProxyStreamChatHeaders(data.data, data.headers, data.query),\n        data: data.data,\n      };\n\n      logger?.debug(\"handleProxyStreamChat providerRequest: \", { providerRequest });\n\n      let buffer = \"\";\n      for await (const chunk of client.stream(\n        providerRequest.url,\n        \"post\",\n        providerRequest.data,\n        providerRequest.headers,\n        undefined,\n        handlerTelemetryContext\n      )) {\n        let accumulatedPartialResponse: PartialChatResponseType[] | undefined = [];\n        try {\n          for await (const transformed of data.model.transformProxyStreamChatResponseChunk(\n            chunk as string,\n            buffer,\n            data.data,\n            data.headers,\n            data.query\n          )) {\n            buffer = transformed.buffer;\n\n            // Check if the partial response contains messages or usage information\n            const hasMessages = transformed.partialResponse?.partialMessages?.length > 0;\n            // Assuming usage information might be present in the partialResponse object, e.g., transformed.partialResponse.usage\n            const hasUsage = transformed.partialResponse?.usage != null; // Adjust this check based on the actual structure of usage data\n\n            if (hasMessages || hasUsage) {\n              accumulatedPartialResponse.push(transformed.partialResponse);\n            }\n          }\n        } catch (transformationError) {\n          logger?.warn(\"handleProxyStreamChat transformation error\", { transformationError });\n          accumulatedPartialResponse = undefined;\n        }\n        const streamResponse: ProxyStreamChatHandlerResponseType = {\n          request: { header: data.headers, data: data.data, query: data.query },\n          providerRequest: providerRequest,\n          providerResponse: chunk,\n          transformedResponse: accumulatedPartialResponse,\n        };\n\n        logger?.debug(\"handleProxyStreamChat streamResponse: \", { streamResponse });\n        yield streamResponse;\n      }\n\n      span?.setStatus({ code: SpanStatusCode.OK });\n    } catch (error) {\n      logger?.warn(\"handleProxyStreamChat error: \", { error });\n      let safeError: GatewayError | HttpRequestError;\n\n      if (HttpRequestError.isHttpRequestError(error)) {\n        safeError = error;\n      } else if (error instanceof GatewayError) {\n        safeError = error;\n      } else {\n        safeError = castToError(error);\n      }\n\n      throw safeError;\n    } finally {\n      span?.end();\n    }\n  };\n\n  if (!telemetryContext) {\n    return yield* _handleProxyStreamChat();\n  }\n\n  return yield* await context.with(telemetryContext, async () => {\n    const tracer = TelemetryManager.getTracer();\n    return await tracer.startActiveSpan(\"proxy-stream-chat.handler\", async (span: Span) => {\n      return await _handleProxyStreamChat(span);\n    });\n  });\n}\n\nexport { handleProxyStreamChat };\n","import { z } from \"zod\";\n\nimport { ChatModelV1 } from \"@adaline/provider\";\nimport { PartialChatResponse } from \"@adaline/types\";\n\nconst ProxyStreamChatHandlerRequest = z.object({\n  model: z.custom<ChatModelV1>(),\n  data: z.any(),\n  headers: z.record(z.string()),\n  query: z.record(z.string()).optional(),\n});\n\ntype ProxyStreamChatHandlerRequestType = z.infer<typeof ProxyStreamChatHandlerRequest>;\n\nconst ProxyStreamChatHandlerResponse = z.object({\n  request: z.any(), // original proxy request from some SDK\n  providerRequest: z.object({\n    url: z.string().url(),\n    headers: z.record(z.string()),\n    data: z.any(),\n  }), // request sent to provider\n  providerResponse: z.any(), // raw chunk from provider\n  transformedResponse: z.array(PartialChatResponse).optional(), // transformed partial response\n});\n\ntype ProxyStreamChatHandlerResponseType = z.infer<typeof ProxyStreamChatHandlerResponse>;\n\nexport {\n  ProxyStreamChatHandlerRequest,\n  ProxyStreamChatHandlerResponse,\n  type ProxyStreamChatHandlerRequestType,\n  type ProxyStreamChatHandlerResponseType,\n};\n","import { Context, context, Span, SpanStatusCode } from \"@opentelemetry/api\";\n\nimport { GatewayError } from \"../../errors/errors\";\nimport { HttpClient, HttpRequestError, LoggerManager, TelemetryManager } from \"../../plugins\";\nimport { castToError, isRunningInBrowser, safelyInvokeCallbacks } from \"../../utils\";\nimport {\n  StreamChatCallbackType,\n  StreamChatHandlerRequest,\n  StreamChatHandlerRequestType,\n  StreamChatHandlerResponseType,\n} from \"./stream-chat.types\";\n\nasync function* handleStreamChat<M>(\n  request: StreamChatHandlerRequestType,\n  client: HttpClient,\n  telemetryContext?: Context\n): AsyncGenerator<StreamChatHandlerResponseType, void, unknown> {\n  const logger = LoggerManager.getLogger();\n  const _handleStreamChat = async function* (span?: Span): AsyncGenerator<StreamChatHandlerResponseType, void, unknown> {\n    logger?.debug(\"handleStreamChat invoked\");\n    logger?.debug(\"handleStreamChat request: \", { request });\n    const data = StreamChatHandlerRequest.parse(request);\n    const callbacks = request.callbacks || [];\n    const handlerTelemetryContext = context.active();\n\n    const stable = {\n      config: data.config,\n      messages: data.messages,\n      tools: data.tools,\n    };\n\n    try {\n      safelyInvokeCallbacks<StreamChatCallbackType, keyof StreamChatCallbackType>(callbacks, \"onStreamStart\", request.metadataForCallbacks);\n\n      const providerRequest = {\n        url: await data.model.getStreamChatUrl(data.config, data.messages, data.tools),\n        headers: await data.model.getStreamChatHeaders(data.config, data.messages, data.tools),\n        data: await data.model.getStreamChatData(data.config, data.messages, data.tools),\n      };\n\n      if (!isRunningInBrowser()) {\n        providerRequest.headers = {\n          ...providerRequest.headers,\n          source: \"adaline.ai\",\n        };\n      }\n\n      if (data.customHeaders) {\n        providerRequest.headers = {\n          ...providerRequest.headers,\n          ...data.customHeaders,\n        };\n      }\n      logger?.debug(\"handleStreamChat providerRequest: \", { providerRequest });\n\n      let buffer = \"\";\n      let isFirstResponse = true;\n      for await (const chunk of client.stream(\n        providerRequest.url,\n        \"post\",\n        providerRequest.data,\n        providerRequest.headers,\n        {\n          abortSignal: request.abortSignal,\n        },\n        handlerTelemetryContext\n      )) {\n        for await (const transformed of data.model.transformStreamChatResponseChunk(chunk as string, buffer)) {\n          // Update the buffer with the remainder returned by the transformer\n          buffer = transformed.buffer;\n\n          // Check if the partial response contains messages or usage information\n          const hasMessages = transformed.partialResponse?.partialMessages?.length > 0;\n          // Assuming usage information might be present in the partialResponse object, e.g., transformed.partialResponse.usage\n          const hasUsage = transformed.partialResponse?.usage != null; // Adjust this check based on the actual structure of usage data\n\n          // Yield the response if it contains messages or usage data\n          if (hasMessages || hasUsage) {\n            const streamResponse = {\n              request: stable,\n              response: transformed.partialResponse,\n              metadataForCallbacks: request.metadataForCallbacks,\n              provider: {\n                request: providerRequest,\n                response: chunk,\n              },\n            };\n\n            safelyInvokeCallbacks<StreamChatCallbackType<M>, keyof StreamChatCallbackType<M>>(\n              callbacks,\n              isFirstResponse ? \"onStreamFirstResponse\" : \"onStreamNewResponse\",\n              request.metadataForCallbacks,\n              streamResponse\n            );\n\n            if (isFirstResponse) {\n              isFirstResponse = false;\n            }\n\n            logger?.debug(\"handleStreamChat streamResponse: \", { streamResponse });\n            yield streamResponse;\n          }\n          // If the transformed part contains neither messages nor usage,\n          // we simply continue with the updated buffer to process the next part or chunk.\n        }\n      }\n\n      span?.setStatus({ code: SpanStatusCode.OK });\n      safelyInvokeCallbacks<StreamChatCallbackType<M>, keyof StreamChatCallbackType<M>>(\n        callbacks,\n        \"onStreamEnd\",\n        request.metadataForCallbacks\n      );\n    } catch (error) {\n      logger?.warn(\"handleStreamChat error: \", { error });\n      let safeError: GatewayError | HttpRequestError;\n\n      if (HttpRequestError.isHttpRequestError(error)) {\n        safeError = error;\n      } else if (error instanceof GatewayError) {\n        safeError = error;\n      } else {\n        safeError = castToError(error);\n      }\n\n      // span?.setStatus({ code: SpanStatusCode.ERROR, message: safeError.message });\n      safelyInvokeCallbacks<StreamChatCallbackType<M>, keyof StreamChatCallbackType<M>>(\n        callbacks,\n        \"onStreamError\",\n        request.metadataForCallbacks,\n        safeError\n      );\n\n      throw safeError;\n    } finally {\n      span?.end();\n    }\n  };\n\n  if (!telemetryContext) {\n    return yield* _handleStreamChat();\n  }\n\n  return yield* await context.with(telemetryContext, async () => {\n    const tracer = TelemetryManager.getTracer();\n    return await tracer.startActiveSpan(\"stream-chat.handler\", async (span: Span) => {\n      return await _handleStreamChat(span);\n    });\n  });\n}\n\nexport { handleStreamChat };\n","import { z } from \"zod\";\n\nimport { ChatModelV1 } from \"@adaline/provider\";\nimport { Config, Message, PartialChatResponse, Tool } from \"@adaline/types\";\n\nimport { GatewayError } from \"../../errors\";\nimport { HttpRequestError } from \"../../plugins\";\n\nconst StreamChatHandlerRequest = z.object({\n  model: z.custom<ChatModelV1>(),\n  config: Config(),\n  messages: z.array(Message()),\n  tools: z.array(Tool()).optional(),\n  customHeaders: z.record(z.string()).optional(),\n  callbacks: z.array(z.custom<StreamChatCallbackType>()).nonempty().optional(),\n  metadataForCallbacks: z.any().optional(),\n  abortSignal: z.instanceof(AbortSignal).optional(),\n});\ntype StreamChatHandlerRequestType = z.infer<typeof StreamChatHandlerRequest>;\n\nconst StreamChatHandlerResponse = z.object({\n  request: z.object({\n    config: Config(),\n    messages: z.array(Message()),\n    tools: z.array(Tool()).optional(),\n  }),\n  response: PartialChatResponse,\n  metadataForCallbacks: z.any().optional(),\n  provider: z.object({\n    request: z.any(),\n    response: z.any(),\n  }),\n});\ntype StreamChatHandlerResponseType = z.infer<typeof StreamChatHandlerResponse>;\n\ntype StreamChatCallbackType<M = any> = {\n  onStreamStart?: (metadata?: M) => Promise<void> | void;\n  onStreamFirstResponse?: (metadata?: M, response?: StreamChatHandlerResponseType, chunk?: unknown) => Promise<void> | void;\n  onStreamNewResponse?: (metadata?: M, response?: StreamChatHandlerResponseType, chunk?: unknown) => Promise<void> | void;\n  onStreamEnd?: (metadata?: M, response?: StreamChatHandlerResponseType) => Promise<void> | void;\n  onStreamError?: (metadata?: M, error?: GatewayError | HttpRequestError) => Promise<void> | void;\n};\n\nexport {\n  StreamChatHandlerRequest,\n  StreamChatHandlerResponse,\n  type StreamChatCallbackType,\n  type StreamChatHandlerRequestType,\n  type StreamChatHandlerResponseType,\n};\n","import { Context, context, Meter, Span, SpanStatusCode, trace, Tracer } from \"@opentelemetry/api\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport { GatewayError } from \"./errors\";\nimport {\n  GatewayCompleteChatRequest,\n  GatewayCompleteChatRequestType,\n  GatewayGetChatUsageCostRequest,\n  GatewayGetChatUsageCostRequestType,\n  GatewayGetEmbeddingsRequest,\n  GatewayGetEmbeddingsRequestType,\n  GatewayOptions,\n  GatewayOptionsType,\n  GatewayProxyCompleteChatRequest,\n  GatewayProxyCompleteChatRequestType,\n  GatewayProxyGetEmbeddingsRequest,\n  GatewayProxyGetEmbeddingsRequestType,\n  GatewayProxyStreamChatRequest,\n  GatewayProxyStreamChatRequestType,\n  GatewayStreamChatRequest,\n  GatewayStreamChatRequestType,\n} from \"./gateway.types\";\nimport {\n  CompleteChatHandlerResponseType,\n  GetChatUsageCostHandlerResponseType,\n  GetEmbeddingsHandlerResponseType,\n  ProxyCompleteChatHandlerResponseType,\n  ProxyGetEmbeddingsHandlerResponseType,\n  ProxyStreamChatHandlerResponseType,\n  StreamChatHandlerResponseType,\n} from \"./handlers\";\nimport { handleCompleteChat } from \"./handlers/complete-chat/complete-chat.handler\";\nimport { handleGetChatUsageCost } from \"./handlers/get-chat-usage-cost/get-chat-usage-cost.handler\";\nimport { handleGetEmbeddings } from \"./handlers/get-embeddings/get-embeddings.handler\";\nimport { handleProxyCompleteChat } from \"./handlers/proxy-complete-chat/proxy-complete-chat.handler\";\nimport { handleProxyGetEmbeddings } from \"./handlers/proxy-get-embeddings/proxy-get-embeddings.handler\";\nimport { handleProxyStreamChat } from \"./handlers/proxy-stream-chat/proxy-stream-chat.handler\";\nimport { handleStreamChat } from \"./handlers/stream-chat/stream-chat.handler\";\nimport { Cache, HttpClient, IsomorphicHttpClient, LRUCache, Queue, QueueTask, SimpleQueue } from \"./plugins\";\nimport { AnalyticsManager, AnalyticsRecorder } from \"./plugins/analytics\";\nimport { Logger, LoggerManager } from \"./plugins/logger\";\nimport { TelemetryManager } from \"./plugins/telemetry\";\nimport { isRunningInBrowser } from \"./utils\";\n\nclass Gateway {\n  private options: GatewayOptionsType;\n\n  private logger?: Logger;\n  private tracer: Tracer;\n  private meter: Meter;\n  private analytics: AnalyticsRecorder;\n\n  private httpClient: HttpClient;\n  private queues: {\n    completeChat: Queue<GatewayCompleteChatRequestType, CompleteChatHandlerResponseType>;\n    getEmbeddings: Queue<GatewayGetEmbeddingsRequestType, GetEmbeddingsHandlerResponseType>;\n    proxyCompleteChat: Queue<GatewayProxyCompleteChatRequestType, ProxyCompleteChatHandlerResponseType>;\n    proxyGetEmbeddings: Queue<GatewayProxyGetEmbeddingsRequestType, ProxyGetEmbeddingsHandlerResponseType>;\n  };\n  private caches: {\n    completeChat: Cache<CompleteChatHandlerResponseType>;\n    getEmbeddings: Cache<GetEmbeddingsHandlerResponseType>;\n  };\n\n  constructor(options: GatewayOptionsType = {}) {\n    if (!options.dangerouslyAllowBrowser && isRunningInBrowser()) {\n      throw new GatewayError(\n        \"It looks like you're running in a browser-like environment. \\\n        This is disabled by default, as it risks exposing your provider secrets to attackers. \\\n        If you understand the risks and have appropriate mitigation in place, \\\n        you can set the `dangerouslyAllowBrowser` option to `true`.\"\n      );\n    }\n\n    this.options = GatewayOptions.parse(options);\n\n    LoggerManager.setLogger(options.logger);\n    this.logger = options.logger;\n\n    this.analytics = AnalyticsManager.getAnalyticsRecorder(\n      this.options.enableAnalytics === undefined ? true : this.options.enableAnalytics\n    );\n\n    TelemetryManager.setTracer(options.telemetry?.tracer);\n    this.tracer = TelemetryManager.getTracer();\n\n    TelemetryManager.setMeter(options.telemetry?.meter);\n    this.meter = TelemetryManager.getMeter();\n\n    const queueOptions = {\n      maxConcurrentTasks: this.options.queueOptions?.maxConcurrentTasks || 4,\n      retryCount: this.options.queueOptions?.retryCount || 3,\n      retry: this.options.queueOptions?.retry || {\n        initialDelay: 1000,\n        exponentialFactor: 2,\n      },\n      timeout: this.options.queueOptions?.timeout || 120000,\n    };\n\n    this.queues = {\n      completeChat: new SimpleQueue(queueOptions),\n      getEmbeddings: new SimpleQueue(queueOptions),\n      proxyCompleteChat: new SimpleQueue(queueOptions),\n      proxyGetEmbeddings: new SimpleQueue(queueOptions),\n    };\n\n    this.options.enableProxyAgent = this.options.enableProxyAgent === undefined ? true : this.options.enableProxyAgent;\n\n    // httpClient timeout is 90% of queue timeout\n    this.httpClient =\n      options.httpClient ||\n      new IsomorphicHttpClient({ timeoutInMilliseconds: queueOptions.timeout * 0.9, enableProxyAgent: this.options.enableProxyAgent });\n\n    this.caches = {\n      completeChat: options.completeChatCache || new LRUCache<CompleteChatHandlerResponseType>(),\n      getEmbeddings: options.getEmbeddingsCache || new LRUCache<GetEmbeddingsHandlerResponseType>(),\n    };\n    this.logger?.debug(\"gateway initialized\");\n  }\n\n  async completeChat(request: GatewayCompleteChatRequestType): Promise<CompleteChatHandlerResponseType> {\n    this.logger?.info(\"gateway.completeChat invoked\");\n    this.logger?.debug(\"request: \", { request });\n    const data = GatewayCompleteChatRequest.parse(request);\n    const modelName = data.model.modelSchema.name;\n    // const counter = this.meter.createCounter(\"completeChat.counter\");\n    // counter.add(1, { modelName });\n    return await this.tracer.startActiveSpan(\"complete-chat\", async (span: Span) => {\n      span.setAttribute(\"modelName\", modelName);\n      return new Promise<CompleteChatHandlerResponseType>((resolve, reject) => {\n        const task: QueueTask<GatewayCompleteChatRequestType, CompleteChatHandlerResponseType> = {\n          id: uuidv4(),\n          request: data,\n          cache: this.caches.completeChat,\n          resolve: (response: CompleteChatHandlerResponseType) => {\n            this.analytics.record(\"completeChat\", \"success\", { modelName, usage: response.response.usage || {} });\n            resolve(response);\n          },\n          reject: (error: any) => {\n            console.log(\"completeChat error\", error);\n            this.analytics.record(\"completeChat\", \"error\", { modelName });\n            reject(error);\n          },\n          execute: this.executeCompleteChat.bind(this),\n          telemetryContext: context.active(),\n        };\n        this.queues.completeChat.enqueue(task);\n        this.logger?.debug(`gateway.completeChat task enqueued, id: ${task.id}`);\n      });\n    });\n  }\n\n  private async executeCompleteChat(\n    request: GatewayCompleteChatRequestType,\n    telemetryContext: Context\n  ): Promise<CompleteChatHandlerResponseType> {\n    this.logger?.debug(\"gateway.executeCompleteChat invoked\");\n    const data = GatewayCompleteChatRequest.parse(request);\n    return handleCompleteChat(\n      {\n        cache: this.caches.completeChat,\n        model: data.model,\n        config: data.config,\n        messages: data.messages,\n        tools: data.tools,\n        enableCache: data.options?.enableCache ?? true,\n        callbacks: this.options.completeChatCallbacks,\n        metadataForCallbacks: data.options?.metadataForCallbacks,\n      },\n      this.httpClient,\n      telemetryContext\n    );\n  }\n\n  async *streamChat(request: GatewayStreamChatRequestType): AsyncGenerator<StreamChatHandlerResponseType, void, unknown> {\n    this.logger?.info(\"gateway.streamChat invoked\");\n    this.logger?.debug(\"request: \", { request });\n    const data = GatewayStreamChatRequest.parse(request);\n    const modelName = data.model.modelSchema.name;\n\n    let status = \"success\";\n    const span = this.tracer.startSpan(\"stream-chat\");\n    const activeContext = trace.setSpan(context.active(), span);\n\n    try {\n      span.setAttribute(\"modelName\", modelName);\n      return yield* await context.with(activeContext, async () => {\n        return handleStreamChat(\n          {\n            model: data.model,\n            config: data.config,\n            messages: data.messages,\n            tools: data.tools,\n            callbacks: this.options.streamChatCallbacks,\n            metadataForCallbacks: data.options?.metadataForCallbacks,\n            abortSignal: data.abortSignal,\n          },\n          this.httpClient,\n          activeContext\n        );\n      });\n    } catch (error) {\n      status = \"error\";\n      span.setStatus({ code: SpanStatusCode.ERROR, message: \"stream failed\" });\n      this.logger?.error(\"gateway.streamChat error: \", { error });\n      if (error instanceof GatewayError) throw error;\n      else throw new GatewayError((error as any)?.message, 500, (error as any)?.response?.data);\n    } finally {\n      this.analytics.record(\"streamChat\", status, { modelName });\n      span.end();\n    }\n  }\n\n  async getEmbeddings(request: GatewayGetEmbeddingsRequestType): Promise<GetEmbeddingsHandlerResponseType> {\n    this.logger?.info(\"gateway.getEmbeddings invoked\");\n    this.logger?.debug(\"request: \", { request });\n    const data = GatewayGetEmbeddingsRequest.parse(request);\n    const modelName = data.model.modelSchema.name;\n    return await this.tracer.startActiveSpan(\"get-embeddings\", async (span: Span) => {\n      span.setAttribute(\"modelName\", modelName);\n      return new Promise<GetEmbeddingsHandlerResponseType>((resolve, reject) => {\n        const task: QueueTask<GatewayGetEmbeddingsRequestType, GetEmbeddingsHandlerResponseType> = {\n          id: uuidv4(),\n          request: data,\n          cache: this.caches.getEmbeddings,\n          resolve: (response: GetEmbeddingsHandlerResponseType) => {\n            this.analytics.record(\"getEmbeddings\", \"success\", { modelName, usage: response.response.usage || {} });\n            resolve(response);\n          },\n          reject: (error: any) => {\n            this.analytics.record(\"getEmbeddings\", \"error\", { modelName });\n            reject(error);\n          },\n          execute: this.executeGetEmbeddings.bind(this),\n          telemetryContext: context.active(),\n        };\n        this.queues.getEmbeddings.enqueue(task);\n        this.logger?.debug(`gateway.getEmbeddings task enqueued, id: ${task.id}`);\n      });\n    });\n  }\n\n  private async executeGetEmbeddings(\n    request: GatewayGetEmbeddingsRequestType,\n    telemetryContext: Context\n  ): Promise<GetEmbeddingsHandlerResponseType> {\n    this.logger?.debug(\"gateway.executeGetEmbeddings invoked\");\n    const data = GatewayGetEmbeddingsRequest.parse(request);\n    return handleGetEmbeddings(\n      {\n        cache: this.caches.getEmbeddings,\n        model: data.model,\n        config: data.config,\n        embeddingRequests: data.embeddingRequests,\n        enableCache: data.options?.enableCache ?? true,\n        callbacks: this.options.getEmbeddingsCallbacks,\n        metadataForCallbacks: data.options?.metadataForCallbacks,\n      },\n      this.httpClient,\n      telemetryContext\n    );\n  }\n\n  async proxyCompleteChat(request: GatewayProxyCompleteChatRequestType): Promise<ProxyCompleteChatHandlerResponseType> {\n    this.logger?.info(\"gateway.proxyCompleteChat invoked\");\n    this.logger?.debug(\"request: \", { request });\n    const data = GatewayProxyCompleteChatRequest.parse(request);\n    const modelName = data.model.modelSchema.name;\n    // const counter = this.meter.createCounter(\"completeChat.counter\");\n    // counter.add(1, { modelName });\n    return await this.tracer.startActiveSpan(\"proxy-complete-chat\", async (span: Span) => {\n      span.setAttribute(\"modelName\", modelName);\n      return new Promise<ProxyCompleteChatHandlerResponseType>((resolve, reject) => {\n        const task: QueueTask<GatewayProxyCompleteChatRequestType, ProxyCompleteChatHandlerResponseType> = {\n          id: uuidv4(),\n          request: data,\n          resolve: (response: ProxyCompleteChatHandlerResponseType) => {\n            this.analytics.record(\"proxyCompleteChat\", \"success\", { modelName, usage: response.transformedResponse?.usage || {} });\n            resolve(response);\n          },\n          reject: (error: any) => {\n            console.log(\"proxyCompleteChat error\", error);\n            this.analytics.record(\"proxyCompleteChat\", \"error\", { modelName });\n            reject(error);\n          },\n          execute: this.executeProxyCompleteChat.bind(this),\n          telemetryContext: context.active(),\n        };\n        this.queues.proxyCompleteChat.enqueue(task);\n        this.logger?.debug(`gateway.proxyCompleteChat task enqueued, id: ${task.id}`);\n      });\n    });\n  }\n\n  private async executeProxyCompleteChat(\n    request: GatewayProxyCompleteChatRequestType,\n    telemetryContext: Context\n  ): Promise<ProxyCompleteChatHandlerResponseType> {\n    this.logger?.debug(\"gateway.executeCompleteChat invoked\");\n    const data = GatewayProxyCompleteChatRequest.parse(request);\n    return handleProxyCompleteChat(\n      {\n        model: data.model,\n        data: data.data,\n        headers: data.headers,\n        query: data.query,\n      },\n      this.httpClient,\n      telemetryContext\n    );\n  }\n\n  async *proxyStreamChat(request: GatewayProxyStreamChatRequestType): AsyncGenerator<ProxyStreamChatHandlerResponseType, void, unknown> {\n    this.logger?.info(\"gateway.proxyStreamChat invoked\");\n    this.logger?.debug(\"proxyStreamChat request: \", { request });\n    const data = GatewayProxyStreamChatRequest.parse(request);\n    const modelName = data.model.modelSchema.name;\n\n    let status = \"success\";\n    const span = this.tracer.startSpan(\"proxy-stream-chat\");\n    const activeContext = trace.setSpan(context.active(), span);\n\n    try {\n      span.setAttribute(\"modelName\", modelName);\n      return yield* await context.with(activeContext, async () => {\n        return handleProxyStreamChat(\n          {\n            model: data.model,\n            data: data.data,\n            headers: data.headers,\n            query: data.query,\n          },\n          this.httpClient,\n          activeContext\n        );\n      });\n    } catch (error) {\n      status = \"error\";\n      span.setStatus({ code: SpanStatusCode.ERROR, message: \"proxy stream failed\" });\n      this.logger?.error(\"gateway.proxyStreamChat error: \", { error });\n      if (error instanceof GatewayError) throw error;\n      else throw new GatewayError((error as any)?.message, 500, (error as any)?.response?.data);\n    } finally {\n      this.analytics.record(\"proxyStreamChat\", status, { modelName });\n      span.end();\n    }\n  }\n  async proxyGetEmbeddings(request: GatewayProxyGetEmbeddingsRequestType): Promise<ProxyGetEmbeddingsHandlerResponseType> {\n    this.logger?.info(\"gateway.proxyGetEmbeddings invoked\");\n    this.logger?.debug(\"request: \", { request });\n\n    // Parse and validate the incoming request\n    const data = GatewayProxyGetEmbeddingsRequest.parse(request);\n    const modelName = data.model.modelSchema.name;\n\n    return await this.tracer.startActiveSpan(\"proxy-get-embeddings\", async (span: Span) => {\n      span.setAttribute(\"modelName\", modelName);\n\n      return new Promise<ProxyGetEmbeddingsHandlerResponseType>((resolve, reject) => {\n        const task: QueueTask<GatewayProxyGetEmbeddingsRequestType, ProxyGetEmbeddingsHandlerResponseType> = {\n          id: uuidv4(),\n          request: data,\n          resolve: (response: ProxyGetEmbeddingsHandlerResponseType) => {\n            this.analytics.record(\"proxyGetEmbeddings\", \"success\", { modelName, usage: response.transformedResponse?.usage || {} });\n            resolve(response);\n          },\n          reject: (error: any) => {\n            this.analytics.record(\"proxyGetEmbeddings\", \"error\", { modelName });\n            reject(error);\n          },\n          execute: this.executeProxyGetEmbeddings.bind(this),\n          telemetryContext: context.active(),\n        };\n        this.queues.proxyGetEmbeddings.enqueue(task);\n        this.logger?.debug(`gateway.proxyGetEmbeddings task enqueued, id: ${task.id}`);\n      });\n    });\n  }\n\n  private async executeProxyGetEmbeddings(\n    request: GatewayProxyGetEmbeddingsRequestType,\n    telemetryContext: Context\n  ): Promise<ProxyGetEmbeddingsHandlerResponseType> {\n    this.logger?.debug(\"gateway.executeProxyGetEmbeddings invoked\");\n    const data = GatewayProxyGetEmbeddingsRequest.parse(request);\n    return handleProxyGetEmbeddings(\n      {\n        model: data.model,\n        headers: data.headers,\n        data: data.data,\n        query: data.query,\n      },\n      this.httpClient,\n      telemetryContext\n    );\n  }\n\n  static getChatUsageCost(request: GatewayGetChatUsageCostRequestType): GetChatUsageCostHandlerResponseType {\n    const data = GatewayGetChatUsageCostRequest.parse(request);\n\n    return handleGetChatUsageCost({ model: data.model, chatModelPrice: data.chatModelPrice, chatUsage: data.chatUsage });\n  }\n\n  static GatewayError = GatewayError;\n}\n\nexport { Gateway, type GatewayOptionsType };\n","import { z } from \"zod\";\n\nimport { ChatModelV1 } from \"@adaline/provider\";\nimport { ChatModelPriceType, ChatUsageType } from \"@adaline/types\";\n\nconst GetChatUsageCostHandlerRequest = z\n  .object({\n    chatUsage: z.custom<ChatUsageType>(),\n    chatModelPrice: z.custom<ChatModelPriceType>().optional(),\n    model: z.custom<ChatModelV1>().optional(),\n  })\n  .refine(\n    (data) => {\n      // Ensure exactly one of chatModelPrice or model is provided\n      return (data.chatModelPrice !== undefined) !== (data.model !== undefined);\n    },\n    {\n      message: \"Exactly one of chatModelPrice or model must be provided, not both.\",\n      path: [\"chatModelPrice\", \"model\"],\n    }\n  );\n\ntype GetChatUsageCostHandlerRequestType = z.infer<typeof GetChatUsageCostHandlerRequest>;\n\nconst GetChatUsageCostHandlerResponse = z.object({\n  cost: z.number(),\n  currency: z.string(),\n  pricingModel: z.custom<ChatModelPriceType>(),\n  usageTokens: z.custom<ChatUsageType>(),\n});\ntype GetChatUsageCostHandlerResponseType = z.infer<typeof GetChatUsageCostHandlerResponse>;\n\nexport {\n  GetChatUsageCostHandlerRequest,\n  GetChatUsageCostHandlerResponse,\n  type GetChatUsageCostHandlerRequestType,\n  type GetChatUsageCostHandlerResponseType,\n};\n"]}